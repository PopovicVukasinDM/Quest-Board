<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest Board - D&D Session Scheduler</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            --parchment: #f4e4bc;
            --parchment-dark: #e8d4a8;
            --parchment-light: #faf3e3;
            --ink: #2c1810;
            --ink-light: #4a3728;
            --gold: #c9a227;
            --gold-light: #e8c547;
            --available: #4a7c59;
            --available-light: #6b9b7a;
            --unavailable: #8b4049;
            --partial: #b8860b;
            --shadow: rgba(44, 24, 16, 0.3);
            --maybe: #d4a574;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Crimson Text', Georgia, serif;
            background: 
                linear-gradient(rgba(26, 15, 10, 0.85), rgba(26, 15, 10, 0.85)),
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill='%23543d2c' fill-opacity='0.4'%3E%3Crect x='0' y='0' width='100' height='100'/%3E%3Cpath d='M0 0h50v50H0zM50 50h50v50H50z' fill='%23604530'/%3E%3C/g%3E%3Cg fill='none' stroke='%23382618' stroke-width='0.5'%3E%3Cpath d='M0 25h100M0 75h100M25 0v100M75 0v100'/%3E%3Cellipse cx='12' cy='12' rx='8' ry='3' transform='rotate(45 12 12)'/%3E%3Cellipse cx='87' cy='38' rx='6' ry='2' transform='rotate(-30 87 38)'/%3E%3Cellipse cx='35' cy='85' rx='7' ry='2' transform='rotate(15 35 85)'/%3E%3C/g%3E%3C/svg%3E");
            background-color: #1a0f0a;
            background-size: 150px 150px;
            min-height: 100vh;
            color: var(--ink);
        }

        .app-container { max-width: 1200px; margin: 0 auto; padding: 1.5rem; }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: linear-gradient(to bottom, rgba(244, 228, 188, 0.97), rgba(232, 212, 168, 0.97));
            border: 3px solid var(--ink);
            border-radius: 4px;
            box-shadow: 0 4px 20px var(--shadow), inset 0 0 60px rgba(44, 24, 16, 0.1);
            position: relative;
        }

        .header::before {
            content: '‚öîÔ∏è';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            background: var(--parchment);
            padding: 0 1rem;
        }

        .header h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--ink);
            text-shadow: 2px 2px 0 var(--gold);
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        .header h1 a { color: inherit; text-decoration: none; }
        .header p { font-size: 1.1rem; font-style: italic; color: var(--ink-light); }

        .header-left {
            position: absolute;
            top: 1rem;
            left: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-right {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--ink);
            color: var(--parchment);
            padding: 0.4rem 0.8rem;
            border-radius: 3px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .user-badge:hover { background: var(--ink-light); }
        .user-badge img { width: 24px; height: 24px; border-radius: 50%; object-fit: cover; }

        .top-controls { display: flex; justify-content: center; gap: 1.5rem; margin-top: 1rem; flex-wrap: wrap; }

        .toggle-group { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; }
        .toggle-group label { color: var(--ink-light); font-size: 0.75rem; font-family: 'Cinzel', serif; }

        .toggle-btn {
            font-family: 'Cinzel', serif;
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
            border: 1px solid var(--ink);
            background: var(--parchment-light);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .toggle-btn:first-of-type { border-radius: 3px 0 0 3px; }
        .toggle-btn:last-of-type { border-radius: 0 3px 3px 0; }
        .toggle-btn.active { background: var(--ink); color: var(--parchment); }
        .toggle-btn:hover:not(.active) { background: var(--parchment-dark); }

        .toggle-btn .flag { width: 16px; height: 12px; display: inline-block; background-size: cover; background-position: center; border-radius: 2px; }
        .flag-gb { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 30'%3E%3CclipPath id='a'%3E%3Cpath d='M0 0v30h60V0z'/%3E%3C/clipPath%3E%3CclipPath id='b'%3E%3Cpath d='M30 15h30v15zv15H0zH0V0zV0h30z'/%3E%3C/clipPath%3E%3Cg clip-path='url(%23a)'%3E%3Cpath d='M0 0v30h60V0z' fill='%23012169'/%3E%3Cpath d='M0 0l60 30m0-30L0 30' stroke='%23fff' stroke-width='6'/%3E%3Cpath d='M0 0l60 30m0-30L0 30' clip-path='url(%23b)' stroke='%23C8102E' stroke-width='4'/%3E%3Cpath d='M30 0v30M0 15h60' stroke='%23fff' stroke-width='10'/%3E%3Cpath d='M30 0v30M0 15h60' stroke='%23C8102E' stroke-width='6'/%3E%3C/g%3E%3C/svg%3E"); }
        .flag-rs { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 450 300'%3E%3Crect width='450' height='100' fill='%23C6363C'/%3E%3Crect y='100' width='450' height='100' fill='%230C4076'/%3E%3Crect y='200' width='450' height='100' fill='%23fff'/%3E%3C/svg%3E"); }

        .main-content { display: grid; grid-template-columns: 280px 1fr; gap: 1.5rem; }

        @media (max-width: 900px) {
            .main-content { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.8rem; }
            .header-left, .header-right { position: static; margin-top: 0.5rem; justify-content: center; }
            .header-left { order: 2; }
        }

        .panel {
            background: linear-gradient(to bottom, rgba(244, 228, 188, 0.97), rgba(232, 212, 168, 0.97));
            border: 2px solid var(--ink);
            border-radius: 4px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .panel h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--ink);
            border-bottom: 2px solid var(--gold);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .panel h2 .edit-event-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.8rem;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .panel h2 .edit-event-btn:hover { opacity: 1; }

        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 0.3rem; color: var(--ink); font-family: 'Cinzel', serif; font-size: 0.9rem; }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.6rem;
            font-family: 'Crimson Text', serif;
            font-size: 1rem;
            border: 1px solid var(--ink-light);
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.7);
            color: var(--ink);
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 5px var(--gold-light);
        }

        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem; }

        .btn {
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0.7rem 1.2rem;
            border: 2px solid var(--ink);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: var(--gold); color: var(--ink); }
        .btn-primary:hover:not(:disabled) { background: var(--gold-light); transform: translateY(-2px); box-shadow: 0 4px 10px var(--shadow); }
        .btn-secondary { background: var(--parchment); color: var(--ink); }
        .btn-secondary:hover:not(:disabled) { background: var(--parchment-dark); }
        .btn-success { background: var(--available); color: white; border-color: var(--available); }
        .btn-success:hover:not(:disabled) { background: var(--available-light); }
        .btn-danger { background: var(--unavailable); color: white; border-color: var(--unavailable); }
        .btn-danger:hover:not(:disabled) { opacity: 0.9; }
        .btn-block { width: 100%; }
        .btn-small { font-size: 0.75rem; padding: 0.4rem 0.8rem; }

        .participant-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--ink);
            color: var(--parchment);
            padding: 0.3rem 0.7rem;
            border-radius: 3px;
            margin: 0.2rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .participant-tag:hover { background: var(--ink-light); }
        .participant-tag img { width: 20px; height: 20px; border-radius: 50%; object-fit: cover; }
        .participant-tag.active { background: var(--gold); color: var(--ink); }

        .schedule-grid { overflow-x: auto; user-select: none; }
        .grid-container { display: grid; gap: 2px; min-width: fit-content; }

        .month-header {
            font-family: 'Cinzel', serif;
            font-weight: 400;
            text-align: center;
            padding: 0.4rem;
            background: var(--ink);
            color: var(--parchment);
            font-size: 1.1rem;
            opacity: 0.7;
            letter-spacing: 0.1em;
        }

        .grid-header {
            text-align: center;
            padding: 0.4rem 0.2rem;
            background: var(--ink);
            color: var(--parchment);
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 70px;
        }

        .grid-header .day-name { font-family: 'Crimson Text', serif; font-size: 0.75rem; font-weight: 400; opacity: 0.85; text-transform: capitalize; }
        .grid-header .day-number { font-family: 'Cinzel', serif; font-size: 0.95rem; font-weight: 600; }

        .time-label {
            font-family: 'Cinzel', serif;
            font-weight: 600;
            padding: 0.3rem 0.5rem;
            background: var(--ink);
            color: var(--parchment);
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 60px;
        }

        .time-label .hour { font-size: 1rem; }
        .time-label .ampm { font-size: 0.65rem; margin-left: 1px; opacity: 0.8; }

        .time-slot {
            min-width: 70px;
            min-height: 40px;
            border: 1px solid var(--ink-light);
            cursor: pointer;
            transition: all 0.1s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .time-slot:hover { transform: scale(1.03); z-index: 10; box-shadow: 0 2px 10px var(--shadow); }
        .time-slot.empty { background: rgba(255, 255, 255, 0.5); }
        .time-slot.level-1 { background: #a8d5a2; }
        .time-slot.level-2 { background: #7bc47a; }
        .time-slot.level-3 { background: #4a9f4a; }
        .time-slot.level-4 { background: #2d7d2d; }
        .time-slot.level-5 { background: var(--available); }
        .time-slot.available { background: var(--available); }
        .time-slot.dragging { background: var(--available-light); }
        .time-slot.has-note::after { content: 'üìú'; position: absolute; top: 1px; right: 1px; font-size: 0.6rem; }

        .availability-count { font-family: 'Cinzel', serif; font-weight: 700; font-size: 0.85rem; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }

        .legend { display: flex; gap: 0.8rem; flex-wrap: wrap; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--ink-light); font-size: 0.85rem; }
        .legend-item { display: flex; align-items: center; gap: 0.4rem; }
        .legend-color { width: 18px; height: 18px; border: 1px solid var(--ink); border-radius: 2px; }

        .tooltip {
            position: fixed;
            background: var(--ink);
            color: var(--parchment);
            padding: 1rem;
            border-radius: 4px;
            max-width: 280px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            pointer-events: none;
        }

        .tooltip h4 { font-family: 'Cinzel', serif; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--gold); }
        .tooltip-entry { margin: 0.5rem 0; padding-left: 0.5rem; border-left: 2px solid var(--gold); display: flex; align-items: center; gap: 0.5rem; }
        .tooltip-entry img { width: 24px; height: 24px; border-radius: 50%; object-fit: cover; }
        .tooltip-name { font-weight: 600; }
        .tooltip-note { font-style: italic; font-size: 0.9rem; color: var(--parchment-dark); margin-top: 0.2rem; }

        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 1rem;
        }

        .modal {
            background: var(--parchment);
            border: 3px solid var(--ink);
            border-radius: 4px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-wide { max-width: 600px; }

        .modal h3 { font-family: 'Cinzel', serif; margin-bottom: 1rem; color: var(--ink); }
        .modal-buttons { display: flex; gap: 1rem; margin-top: 1.5rem; }
        .modal-buttons-spread { display: flex; justify-content: space-between; align-items: center; margin-top: 1.5rem; gap: 1rem; }
        .modal-buttons-spread .btn-danger { margin-right: auto; }

        .view-toggle { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .view-toggle .btn { flex: 1; font-size: 0.75rem; padding: 0.5rem 0.3rem; }
        .view-toggle .btn.active { background: var(--ink); color: var(--parchment); }

        .instructions { background: rgba(201, 162, 39, 0.2); border: 1px solid var(--gold); border-radius: 4px; padding: 0.8rem; margin-bottom: 1rem; font-size: 0.85rem; }
        .instructions strong { display: block; margin-bottom: 0.4rem; }
        .instructions ul { margin: 0; padding-left: 1.2rem; }
        .instructions li { margin: 0.3rem 0; }

        .share-box { background: var(--parchment-light); border: 2px dashed var(--gold); border-radius: 4px; padding: 1rem; margin: 1rem 0; text-align: center; }
        .share-url { font-family: monospace; font-size: 0.85rem; background: white; padding: 0.5rem; border-radius: 3px; word-break: break-all; margin: 0.5rem 0; display: block; }

        .center-panel { max-width: 600px; margin: 0 auto; }

        .date-picker-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin: 1rem 0; }
        .date-picker-header { font-family: 'Cinzel', serif; font-size: 0.7rem; text-align: center; padding: 0.3rem; color: var(--ink-light); }

        .date-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--ink-light);
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.15s;
        }

        .date-cell:hover { background: var(--parchment-dark); }
        .date-cell.selected { background: var(--available); color: white; }
        .date-cell.disabled { opacity: 0.3; cursor: not-allowed; }
        .date-cell.has-availability { background: var(--gold); color: var(--ink); }

        .month-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
        .month-nav button { background: none; border: none; font-size: 1.2rem; cursor: pointer; padding: 0.3rem 0.6rem; }
        .month-nav span { font-family: 'Cinzel', serif; font-weight: 600; }

        .loading { text-align: center; padding: 3rem; font-style: italic; color: var(--ink-light); }
        .error-message { background: #ffebee; border: 1px solid var(--unavailable); color: var(--unavailable); padding: 1rem; border-radius: 4px; margin: 1rem 0; }
        .success-message { background: #e8f5e9; border: 1px solid var(--available); color: var(--available); padding: 1rem; border-radius: 4px; margin: 1rem 0; }
        .warning-message { background: #fff8e1; border: 1px solid var(--gold); color: var(--ink); padding: 1rem; border-radius: 4px; margin: 1rem 0; }

        .saved-indicator {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--available);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            font-family: 'Cinzel', serif;
            box-shadow: 0 4px 15px var(--shadow);
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(20px); }
            20% { opacity: 1; transform: translateY(0); }
            80% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }

        .landing-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-top: 1rem; }

        .landing-card {
            background: var(--parchment-light);
            border: 2px solid var(--ink-light);
            border-radius: 4px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .landing-card:hover { border-color: var(--gold); transform: translateY(-3px); box-shadow: 0 6px 20px var(--shadow); }
        .landing-card .icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .landing-card h3 { font-family: 'Cinzel', serif; font-size: 1rem; margin-bottom: 0.5rem; }
        .landing-card p { font-size: 0.85rem; color: var(--ink-light); }

        /* Profile styles */
        .profile-header { display: flex; align-items: center; gap: 1.5rem; margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 2px solid var(--gold); }
        .profile-image-container { position: relative; }
        .profile-image { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--ink); object-fit: cover; background: var(--parchment-dark); }
        .profile-image-placeholder { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--ink); background: var(--parchment-dark); display: flex; align-items: center; justify-content: center; font-size: 2.5rem; }

        .edit-icon { position: absolute; bottom: 0; right: 0; background: var(--ink); color: var(--parchment); width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.8rem; border: 2px solid var(--parchment); transition: all 0.2s; }
        .edit-icon:hover { background: var(--ink-light); }

        .inline-edit { display: flex; align-items: center; gap: 0.5rem; }
        .inline-edit-input { font-family: 'Cinzel', serif; font-size: 1.5rem; padding: 0.3rem 0.5rem; border: 1px solid var(--gold); border-radius: 3px; }

        .edit-actions { display: flex; gap: 0.3rem; }
        .edit-btn { width: 28px; height: 28px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; transition: all 0.2s; }
        .edit-btn.confirm { background: var(--available); color: white; }
        .edit-btn.cancel { background: #999; color: white; }
        .edit-btn.delete { background: var(--unavailable); color: white; }
        .edit-btn:hover { transform: scale(1.1); }

        .profile-info h2 { font-family: 'Cinzel', serif; border: none; padding: 0; margin: 0; display: flex; align-items: center; gap: 0.5rem; }
        .profile-info p { color: var(--ink-light); font-size: 0.9rem; }

        .name-edit-icon { background: none; border: none; cursor: pointer; font-size: 0.8rem; opacity: 0.6; transition: opacity 0.2s; }
        .name-edit-icon:hover { opacity: 1; }

        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .section-header h3 { font-family: 'Cinzel', serif; font-size: 1.1rem; color: var(--ink); }
        .section-actions { display: flex; gap: 0.5rem; }

        .adventurer-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--parchment-light);
            border: 1px solid var(--ink-light);
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .adventurer-card:hover { border-color: var(--gold); }
        .adventurer-card img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid var(--ink); }
        .adventurer-card .no-image { width: 50px; height: 50px; border-radius: 50%; background: var(--ink); color: var(--parchment); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; border: 2px solid var(--ink); }
        .adventurer-card .info { flex: 1; }
        .adventurer-card .name { font-family: 'Cinzel', serif; font-weight: 600; }
        .adventurer-card .subtitle { font-size: 0.8rem; color: var(--ink-light); }
        .adventurer-card .actions { display: flex; gap: 0.5rem; }

        .adventurer-detail { margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--ink-light); font-size: 0.85rem; }
        .adventurer-detail-row { display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 0.3rem; }
        .adventurer-detail-item { display: flex; gap: 0.3rem; }
        .adventurer-detail-item strong { color: var(--ink); }

        .event-list-item {
            display: block;
            background: var(--parchment-light);
            border: 1px solid var(--ink-light);
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            text-decoration: none;
            color: var(--ink);
            transition: all 0.2s;
        }

        .event-list-item:hover { border-color: var(--gold); background: var(--parchment); }
        .event-list-item h4 { font-family: 'Cinzel', serif; margin-bottom: 0.3rem; display: flex; align-items: center; gap: 0.5rem; }
        .event-list-item p { font-size: 0.85rem; color: var(--ink-light); }
        .event-list-item .participants-row { display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap; }

        .event-card-with-image { position: relative; overflow: hidden; min-height: 100px; }
        .event-card-with-image .event-card-content { padding-top: 60px; }
        .event-card-image { position: absolute; top: 0; left: 0; right: 0; height: 80px; background-size: cover; background-position: center; opacity: 0.75; mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,0.5) 50%, rgba(0,0,0,0) 100%); -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,0.5) 50%, rgba(0,0,0,0) 100%); pointer-events: none; }
        .event-card-content { position: relative; z-index: 1; }

        .tag { display: inline-block; background: var(--gold); color: var(--ink); padding: 0.15rem 0.5rem; border-radius: 3px; font-size: 0.7rem; font-family: 'Cinzel', serif; margin-right: 0.3rem; margin-bottom: 0.3rem; }
        .tag-row { display: flex; flex-wrap: wrap; margin-bottom: 0.5rem; }
        .tag-input-row { display: flex; gap: 0.5rem; align-items: center; }
        .tag-input-row input { flex: 1; }
        .tag-input-row button { flex-shrink: 0; }
        .tags-display { display: flex; flex-wrap: wrap; gap: 0.3rem; margin-top: 0.5rem; }
        .tag-removable { cursor: pointer; }
        .tag-removable:hover { opacity: 0.7; }
        .tag-removable::after { content: ' √ó'; }

        .tag-filter { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--ink-light); align-items: center; }
        .tag-filter-btn { background: var(--parchment-light); border: 1px solid var(--ink-light); padding: 0.3rem 0.6rem; border-radius: 3px; font-size: 0.75rem; font-family: 'Cinzel', serif; cursor: pointer; transition: all 0.2s; }
        .tag-filter-btn:hover { border-color: var(--gold); }
        .tag-filter-btn.active { background: var(--gold); border-color: var(--gold); }
        .tag-filter-dropdown { position: relative; }
        .tag-filter-toggle { background: var(--parchment-light); border: 1px solid var(--ink-light); padding: 0.4rem 0.8rem; border-radius: 3px; font-size: 0.85rem; font-family: 'Cinzel', serif; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; }
        .tag-filter-toggle:hover { border-color: var(--gold); }
        .tag-filter-menu { position: absolute; top: 100%; left: 0; background: var(--parchment); border: 1px solid var(--ink-light); border-radius: 3px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 100; min-width: 200px; max-height: 300px; overflow-y: auto; margin-top: 0.3rem; }
        .tag-filter-item { padding: 0.5rem 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; border-bottom: 1px solid var(--parchment-light); }
        .tag-filter-item:last-child { border-bottom: none; }
        .tag-filter-item:hover { background: var(--parchment-light); }
        .tag-filter-item input[type="checkbox"] { width: 16px; height: 16px; accent-color: var(--gold); }
        .tag-filter-count { background: var(--gold); color: var(--ink); font-size: 0.7rem; padding: 0.1rem 0.4rem; border-radius: 10px; margin-left: auto; }

        .password-section { background: var(--parchment-light); border: 1px solid var(--ink-light); border-radius: 4px; padding: 1rem; margin-top: 1rem; }
        .danger-section { border-color: var(--unavailable); }
        .danger-section .password-header h4 { color: var(--unavailable); }
        .password-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .password-header h4 { font-family: 'Cinzel', serif; font-size: 0.95rem; color: var(--ink); display: flex; align-items: center; gap: 0.5rem; }
        .password-header .toggle-arrow { transition: transform 0.2s; }
        .password-header .toggle-arrow.open { transform: rotate(180deg); }
        .password-form { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--ink-light); }

        .confirm-dialog { text-align: center; }
        .confirm-dialog p { margin-bottom: 1.5rem; font-size: 1.1rem; }
        .confirm-dialog .btn { margin: 0 0.5rem; }

        .switch-adventurer-btn { background: none; border: none; padding: 0.2rem 0.4rem; font-size: 0.7rem; cursor: pointer; color: var(--ink-light); margin-left: 0.3rem; transition: all 0.2s; opacity: 0.6; }
        .switch-adventurer-btn:hover { opacity: 1; color: var(--ink); }

        .divider { border: none; border-top: 1px solid var(--ink-light); margin: 1.5rem 0; }

        .quest-board-list { margin-top: 0.5rem; }
        .quest-board-list-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: white; border-radius: 3px; margin-bottom: 0.3rem; cursor: pointer; transition: all 0.2s; }
        .quest-board-list-item:hover { background: var(--parchment-dark); }
        .quest-board-list-item > div:first-child { flex: 1; }
        .quest-board-list-item .name { font-size: 0.9rem; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef, createContext, useContext } = React;

        const AuthContext = createContext(null);
        function useAuth() { return useContext(AuthContext); }

        const translations = {
            en: {
                questBoard: "Quest Board",
                tagline: "Schedule your next adventure with your party",
                timeFormat: "Time",
                language: "Language",
                createNewQuest: "Create New Quest",
                eventName: "Event Name",
                eventNamePlaceholder: "e.g., D&D Session 3",
                description: "Description (optional)",
                descriptionPlaceholder: "e.g., Continuing the Velhmael campaign...",
                selectDates: "Select Possible Dates",
                selected: "selected",
                startTime: "Start Time",
                endTime: "End Time",
                createQuestBoard: "Create Quest Board",
                creating: "Creating...",
                adventurer: "Adventurer",
                joinQuest: "Join Quest",
                joinPrompt: "Join the quest to mark your availability",
                group: "Group",
                edit: "Edit",
                party: "Party",
                noAdventurers: "No adventurers yet",
                inviteParty: "Invite your party!",
                copyLink: "Copy Link",
                copied: "Copied!",
                all: "All",
                most: "Most",
                some: "Some",
                available: "Available",
                hasNote: "Has note",
                enterName: "Enter Your Name",
                howShouldPartyKnow: "How should the party know you?",
                yourName: "Your name...",
                cancel: "Cancel",
                addNote: "Add a Note",
                yourNote: "Your note",
                notePlaceholder: "e.g., Maybe, need to check...",
                saveNote: "Save Note",
                saved: "Saved!",
                noOneAvailable: "No one available yet",
                eventNotFound: "Event not found",
                loadingDice: "Rolling for initiative...",
                instructionsTitle: "Instructions:",
                instruction1: "Click slots to mark availability",
                instruction2: "Right-click any slot to add notes",
                instruction3: "Notes appear as üìú icons",
                months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
                days: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
                daysShort: ["S", "M", "T", "W", "T", "F", "S"],
                ordinal: (n) => { const s = ["th", "st", "nd", "rd"]; const v = n % 100; return n + (s[(v - 20) % 10] || s[v] || s[0]); },
                atTime: "at",
                welcome: "Welcome, Adventurer!",
                whatToDo: "What would you like to do?",
                login: "Login",
                register: "Register",
                createEvent: "Create Event",
                joinEvent: "Join Event",
                loginDesc: "Access your profile",
                registerDesc: "Create a new account",
                createEventDesc: "Start a new quest board",
                joinEventDesc: "Join with a link",
                username: "Username",
                password: "Password",
                displayName: "Display Name",
                loginTitle: "Login to Quest Board",
                registerTitle: "Create Your Account",
                loggingIn: "Logging in...",
                registering: "Creating account...",
                logout: "Logout",
                profile: "Profile",
                myProfile: "My Profile",
                myAdventurers: "My Adventurers",
                myQuestBoards: "My Quest Boards",
                createdByMe: "Created by Me",
                participating: "Participating In",
                changePassword: "Change Password",
                currentPassword: "Current Password",
                newPassword: "New Password",
                passwordChanged: "Password changed successfully!",
                profileUpdated: "Profile updated!",
                createAdventurer: "Create Adventurer",
                editAdventurer: "Edit Adventurer",
                adventurerName: "Adventurer Name",
                adventurerImage: "Adventurer Image (URL)",
                noAdventurersSaved: "No adventurers saved yet",
                selectAdventurer: "Select an Adventurer",
                orEnterName: "Or enter a name manually",
                useAdventurer: "Use This Adventurer",
                joinEventTitle: "Join a Quest Board",
                pasteLink: "Paste the link your friend sent you",
                eventLink: "Event Link",
                go: "Go",
                profileImage: "Profile Image (URL)",
                save: "Save",
                noQuestBoards: "No quest boards yet",
                deleteAdventurer: "Delete Adventurer",
                confirmDelete: "Are you sure you want to delete this adventurer?",
                yes: "Yes",
                no: "No",
                switchAdventurer: "Switch",
                joinedAs: "Joined as",
                questBoards: "quest boards",
                bio: "Bio",
                level: "Level",
                race: "Race",
                class: "Class",
                notes: "Notes",
                viewAdventurer: "View Adventurer",
                editEvent: "Edit Quest Board",
                warningRemoveDates: "Warning: Some dates have existing availability. Removing them will delete that data.",
                warningChangeHours: "Warning: Changing hours may affect existing availability data.",
                update: "Update",
                deleteProfile: "Delete Profile",
                deleteProfileWarning: "Are you sure? This will permanently delete your account, all adventurers, and all quest boards you created.",
                deleteQuestBoard: "Delete Quest Board",
                deleteQuestBoardWarning: "Are you sure you want to delete this quest board? This will remove all availability data.",
                questBoardImage: "Quest Board Image (URL)",
                tags: "Tags / Campaign",
                tagsPlaceholder: "e.g., Adventures in Faerun",
                addTag: "Add",
                maxTags: "Max 3 tags",
                filterByTag: "Filter by tag",
                allTags: "All",
            },
            sr: {
                questBoard: "Tabla Zadataka",
                tagline: "Zaka≈æite svoju sledeƒáu avanturu sa svojom dru≈æinom",
                timeFormat: "Vreme",
                language: "Jezik",
                createNewQuest: "Kreiraj Novi Zadatak",
                eventName: "Naziv Dogaƒëaja",
                eventNamePlaceholder: "npr., D&D Sesija 3",
                description: "Opis (opciono)",
                descriptionPlaceholder: "npr., Nastavljamo Velhmael kampanju...",
                selectDates: "Izaberi Moguƒáe Datume",
                selected: "izabrano",
                startTime: "Poƒçetak",
                endTime: "Kraj",
                createQuestBoard: "Kreiraj Tablu",
                creating: "Kreiranje...",
                adventurer: "Avanturista",
                joinQuest: "Pridru≈æi se",
                joinPrompt: "Pridru≈æi se zadatku da oznaƒçi≈° dostupnost",
                group: "Grupa",
                edit: "Izmeni",
                party: "Dru≈æina",
                noAdventurers: "Jo≈° nema avanturista",
                inviteParty: "Pozovi dru≈æinu!",
                copyLink: "Kopiraj Link",
                copied: "Kopirano!",
                all: "Svi",
                most: "Veƒáina",
                some: "Neki",
                available: "Dostupan",
                hasNote: "Ima bele≈°ku",
                enterName: "Unesi Svoje Ime",
                howShouldPartyKnow: "Kako da te dru≈æina zove?",
                yourName: "Tvoje ime...",
                cancel: "Otka≈æi",
                addNote: "Dodaj Bele≈°ku",
                yourNote: "Tvoja bele≈°ka",
                notePlaceholder: "npr., Mo≈æda, moram da proverim...",
                saveNote: "Saƒçuvaj",
                saved: "Saƒçuvano!",
                noOneAvailable: "Niko jo≈° nije dostupan",
                eventNotFound: "Dogaƒëaj nije pronaƒëen",
                loadingDice: "Bacamo kockice...",
                instructionsTitle: "Uputstva:",
                instruction1: "Klikni na polja da oznaƒçi≈° dostupnost",
                instruction2: "Desni klik na bilo koje polje za bele≈°ke",
                instruction3: "Bele≈°ke se prikazuju kao üìú ikone",
                months: ["Januar", "Februar", "Mart", "April", "Maj", "Jun", "Jul", "Avgust", "Septembar", "Oktobar", "Novembar", "Decembar"],
                days: ["Nedelja", "Ponedeljak", "Utorak", "Sreda", "ƒåetvrtak", "Petak", "Subota"],
                daysShort: ["N", "P", "U", "S", "ƒå", "P", "S"],
                ordinal: (n) => n + ".",
                atTime: "u",
                welcome: "Dobrodo≈°li, Avanturisto!",
                whatToDo: "≈†ta ≈æelite da uradite?",
                login: "Prijava",
                register: "Registracija",
                createEvent: "Kreiraj Dogaƒëaj",
                joinEvent: "Pridru≈æi se",
                loginDesc: "Pristupite svom profilu",
                registerDesc: "Napravite novi nalog",
                createEventDesc: "Zapoƒçnite novu tablu",
                joinEventDesc: "Pridru≈æite se putem linka",
                username: "Korisniƒçko ime",
                password: "Lozinka",
                displayName: "Ime za prikaz",
                loginTitle: "Prijavite se",
                registerTitle: "Kreirajte nalog",
                loggingIn: "Prijavljivanje...",
                registering: "Kreiranje naloga...",
                logout: "Odjava",
                profile: "Profil",
                myProfile: "Moj Profil",
                myAdventurers: "Moji Avanturisti",
                myQuestBoards: "Moje Table",
                createdByMe: "Moje kreacije",
                participating: "Uƒçestvujem u",
                changePassword: "Promeni lozinku",
                currentPassword: "Trenutna lozinka",
                newPassword: "Nova lozinka",
                passwordChanged: "Lozinka promenjena!",
                profileUpdated: "Profil a≈æuriran!",
                createAdventurer: "Kreiraj Avanturistu",
                editAdventurer: "Izmeni Avanturistu",
                adventurerName: "Ime Avanturiste",
                adventurerImage: "Slika Avanturiste (URL)",
                noAdventurersSaved: "Nema saƒçuvanih avanturista",
                selectAdventurer: "Izaberi Avanturistu",
                orEnterName: "Ili unesi ime ruƒçno",
                useAdventurer: "Koristi ovog Avanturistu",
                joinEventTitle: "Pridru≈æi se Tabli",
                pasteLink: "Nalepi link koji ti je prijatelj poslao",
                eventLink: "Link dogaƒëaja",
                go: "Idi",
                profileImage: "Slika profila (URL)",
                save: "Saƒçuvaj",
                noQuestBoards: "Nema tabli",
                deleteAdventurer: "Obri≈°i Avanturistu",
                confirmDelete: "Da li ste sigurni da ≈æelite da obri≈°ete ovog avanturistu?",
                yes: "Da",
                no: "Ne",
                switchAdventurer: "Promeni",
                joinedAs: "Kao",
                questBoards: "tabli",
                bio: "Biografija",
                level: "Nivo",
                race: "Rasa",
                class: "Klasa",
                notes: "Bele≈°ke",
                viewAdventurer: "Pogledaj Avanturistu",
                editEvent: "Izmeni Tablu",
                warningRemoveDates: "Upozorenje: Neki datumi imaju postojeƒáu dostupnost. Uklanjanje ƒáe obrisati te podatke.",
                warningChangeHours: "Upozorenje: Promena sati mo≈æe uticati na postojeƒáe podatke o dostupnosti.",
                update: "A≈æuriraj",
                deleteProfile: "Obri≈°i Profil",
                deleteProfileWarning: "Da li ste sigurni? Ovo ƒáe trajno obrisati va≈° nalog, sve avanturiste i sve table koje ste kreirali.",
                deleteQuestBoard: "Obri≈°i Tablu",
                deleteQuestBoardWarning: "Da li ste sigurni da ≈æelite da obri≈°ete ovu tablu? Ovo ƒáe ukloniti sve podatke o dostupnosti.",
                questBoardImage: "Slika Table (URL)",
                tags: "Oznake / Kampanja",
                tagsPlaceholder: "npr., Avanture u Faerun-u",
                addTag: "Dodaj",
                maxTags: "Maks 3 oznake",
                filterByTag: "Filtriraj po oznaci",
                allTags: "Sve",
            }
        };

        function getSlotKey(date, hour) { return `${date}-${hour}`; }

        async function api(endpoint, options = {}) {
            const token = localStorage.getItem('quest-board-token');
            const headers = { 'Content-Type': 'application/json', ...(token && { 'Authorization': `Bearer ${token}` }) };
            const res = await fetch(endpoint, { ...options, headers });
            const data = await res.json();
            if (res.status === 401 && token && !endpoint.includes('/auth/')) {
                localStorage.removeItem('quest-board-token');
                window.location.href = '/';
                throw new Error('Session expired - please log in again');
            }
            if (!res.ok) throw new Error(data.error || 'Request failed');
            return data;
        }

        function App() {
            const [route, setRoute] = useState({ page: 'home', params: {} });
            const [lang, setLang] = useState(() => localStorage.getItem('quest-board-lang') || 'en');
            const [timeFormat, setTimeFormat] = useState(() => localStorage.getItem('quest-board-time') || '12');
            const [user, setUser] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);
            const t = translations[lang];

            useEffect(() => { localStorage.setItem('quest-board-lang', lang); }, [lang]);
            useEffect(() => { localStorage.setItem('quest-board-time', timeFormat); }, [timeFormat]);

            useEffect(() => {
                async function checkAuth() {
                    const token = localStorage.getItem('quest-board-token');
                    if (token) {
                        try { 
                            const data = await api('/api/auth/me'); 
                            if (data.user) setUser(data.user);
                            else localStorage.removeItem('quest-board-token');
                        } catch { localStorage.removeItem('quest-board-token'); }
                    }
                    setAuthLoading(false);
                }
                checkAuth();
            }, []);

            useEffect(() => {
                function handleRoute() {
                    const path = window.location.pathname;
                    if (path.startsWith('/event/')) setRoute({ page: 'event', params: { eventId: path.split('/event/')[1] } });
                    else if (path === '/create') setRoute({ page: 'create', params: {} });
                    else if (path === '/profile') setRoute({ page: 'profile', params: {} });
                    else if (path === '/join') setRoute({ page: 'join', params: {} });
                    else setRoute({ page: 'home', params: {} });
                }
                handleRoute();
                window.addEventListener('popstate', handleRoute);
                return () => window.removeEventListener('popstate', handleRoute);
            }, []);

            const navigate = (path) => { window.history.pushState({}, '', path); window.dispatchEvent(new PopStateEvent('popstate')); };
            const login = (token, userData) => { localStorage.setItem('quest-board-token', token); setUser(userData); };
            const logout = async () => { try { await api('/api/auth/logout', { method: 'POST' }); } catch {} localStorage.removeItem('quest-board-token'); setUser(null); navigate('/'); };

            if (authLoading) return <div className="app-container"><div className="panel loading">üé≤ {t.loadingDice}</div></div>;

            return (
                <AuthContext.Provider value={{ user, setUser, login, logout, t, lang, timeFormat, navigate }}>
                    <div className="app-container">
                        <header className="header">
                            <div className="header-left">
                                <div className="toggle-group">
                                    <label>{t.timeFormat}:</label>
                                    <button className={`toggle-btn ${timeFormat === '12' ? 'active' : ''}`} onClick={() => setTimeFormat('12')}>12h</button>
                                    <button className={`toggle-btn ${timeFormat === '24' ? 'active' : ''}`} onClick={() => setTimeFormat('24')}>24h</button>
                                </div>
                                <div className="toggle-group">
                                    <label>{t.language}:</label>
                                    <button className={`toggle-btn ${lang === 'en' ? 'active' : ''}`} onClick={() => setLang('en')}>
                                        <span className="flag flag-gb"></span> EN
                                    </button>
                                    <button className={`toggle-btn ${lang === 'sr' ? 'active' : ''}`} onClick={() => setLang('sr')}>
                                        <span className="flag flag-rs"></span> SR
                                    </button>
                                </div>
                            </div>
                            {user && (
                                <div className="header-right">
                                    <div className="user-badge" onClick={() => navigate('/profile')}>
                                        {user.profileImage ? <img src={user.profileImage} alt="" /> : <span>üë§</span>}
                                        {user.displayName}
                                    </div>
                                    <button className="btn btn-small btn-secondary" onClick={logout}>{t.logout}</button>
                                </div>
                            )}
                            <h1><a href="/" onClick={(e) => { e.preventDefault(); navigate('/'); }}>{t.questBoard}</a></h1>
                            <p>{t.tagline}</p>
                        </header>
                        {route.page === 'home' && <LandingPage t={t} />}
                        {route.page === 'create' && <CreateEventPage t={t} lang={lang} timeFormat={timeFormat} />}
                        {route.page === 'join' && <JoinEventPage t={t} />}
                        {route.page === 'profile' && <ProfilePage t={t} lang={lang} />}
                        {route.page === 'event' && <EventPage eventId={route.params.eventId} t={t} lang={lang} timeFormat={timeFormat} />}
                    </div>
                </AuthContext.Provider>
            );
        }

        function LandingPage({ t }) {
            const { user, navigate } = useAuth();
            const [showLogin, setShowLogin] = useState(false);
            const [showRegister, setShowRegister] = useState(false);

            return (
                <div className="center-panel">
                    <div className="panel">
                        <h2>üè∞ {t.welcome}</h2>
                        <p style={{ marginBottom: '1.5rem', color: 'var(--ink-light)' }}>{t.whatToDo}</p>
                        <div className="landing-options">
                            {!user && (
                                <>
                                    <div className="landing-card" onClick={() => setShowLogin(true)}><div className="icon">üîë</div><h3>{t.login}</h3><p>{t.loginDesc}</p></div>
                                    <div className="landing-card" onClick={() => setShowRegister(true)}><div className="icon">üìù</div><h3>{t.register}</h3><p>{t.registerDesc}</p></div>
                                </>
                            )}
                            <div className="landing-card" onClick={() => navigate('/create')}><div className="icon">‚öîÔ∏è</div><h3>{t.createEvent}</h3><p>{t.createEventDesc}</p></div>
                            <div className="landing-card" onClick={() => navigate('/join')}><div className="icon">üé≠</div><h3>{t.joinEvent}</h3><p>{t.joinEventDesc}</p></div>
                        </div>
                    </div>
                    {showLogin && <LoginModal onClose={() => setShowLogin(false)} t={t} />}
                    {showRegister && <RegisterModal onClose={() => setShowRegister(false)} t={t} />}
                </div>
            );
        }

        function LoginModal({ onClose, t }) {
            const { login } = useAuth();
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true); setError('');
                try { const data = await api('/api/auth/login', { method: 'POST', body: JSON.stringify({ username, password }) }); login(data.token, data.user); onClose(); } 
                catch (err) { setError(err.message); } 
                finally { setLoading(false); }
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={e => e.stopPropagation()}>
                        <h3>üîë {t.loginTitle}</h3>
                        {error && <div className="error-message">{error}</div>}
                        <form onSubmit={handleSubmit}>
                            <div className="form-group"><label>{t.username}</label><input type="text" value={username} onChange={e => setUsername(e.target.value)} required autoFocus /></div>
                            <div className="form-group"><label>{t.password}</label><input type="password" value={password} onChange={e => setPassword(e.target.value)} required /></div>
                            <div className="modal-buttons">
                                <button type="button" className="btn btn-secondary" onClick={onClose}>{t.cancel}</button>
                                <button type="submit" className="btn btn-primary" disabled={loading}>{loading ? t.loggingIn : t.login}</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        function RegisterModal({ onClose, t }) {
            const { login } = useAuth();
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [displayName, setDisplayName] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true); setError('');
                try { const data = await api('/api/auth/register', { method: 'POST', body: JSON.stringify({ username, password, displayName: displayName || username }) }); login(data.token, data.user); onClose(); } 
                catch (err) { setError(err.message); } 
                finally { setLoading(false); }
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={e => e.stopPropagation()}>
                        <h3>üìù {t.registerTitle}</h3>
                        {error && <div className="error-message">{error}</div>}
                        <form onSubmit={handleSubmit}>
                            <div className="form-group"><label>{t.username} *</label><input type="text" value={username} onChange={e => setUsername(e.target.value)} required autoFocus /></div>
                            <div className="form-group"><label>{t.displayName}</label><input type="text" value={displayName} onChange={e => setDisplayName(e.target.value)} placeholder={username || t.yourName} /></div>
                            <div className="form-group"><label>{t.password} *</label><input type="password" value={password} onChange={e => setPassword(e.target.value)} required /></div>
                            <div className="modal-buttons">
                                <button type="button" className="btn btn-secondary" onClick={onClose}>{t.cancel}</button>
                                <button type="submit" className="btn btn-primary" disabled={loading}>{loading ? t.registering : t.register}</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        function JoinEventPage({ t }) {
            const { navigate } = useAuth();
            const [link, setLink] = useState('');
            const [error, setError] = useState('');

            const handleGo = () => {
                let eventId = link.trim();
                if (eventId.includes('/event/')) eventId = eventId.split('/event/')[1].split(/[?#]/)[0];
                if (!eventId) { setError(t.eventNotFound); return; }
                navigate(`/event/${eventId}`);
            };

            return (
                <div className="center-panel">
                    <div className="panel">
                        <h2>üé≠ {t.joinEventTitle}</h2>
                        <p style={{ marginBottom: '1rem', color: 'var(--ink-light)' }}>{t.pasteLink}</p>
                        {error && <div className="error-message">{error}</div>}
                        <div className="form-group"><label>{t.eventLink}</label><input type="text" value={link} onChange={e => setLink(e.target.value)} placeholder="https://... or event ID" onKeyDown={e => e.key === 'Enter' && handleGo()} /></div>
                        <button className="btn btn-primary btn-block" onClick={handleGo}>üöÄ {t.go}</button>
                    </div>
                </div>
            );
        }

        function ProfilePage({ t, lang }) {
            const { user, setUser, logout, navigate } = useAuth();
            const [adventurers, setAdventurers] = useState([]);
            const [events, setEvents] = useState({ created: [], participated: [] });
            const [loading, setLoading] = useState(true);
            const [message, setMessage] = useState('');
            const [error, setError] = useState('');

            const [editingName, setEditingName] = useState(false);
            const [editingImage, setEditingImage] = useState(false);
            const [tempName, setTempName] = useState(user?.displayName || '');
            const [tempImage, setTempImage] = useState(user?.profileImage || '');
            const [showPasswordForm, setShowPasswordForm] = useState(false);
            const [showDeleteProfile, setShowDeleteProfile] = useState(false);
            const [currentPassword, setCurrentPassword] = useState('');
            const [newPassword, setNewPassword] = useState('');

            const [advModal, setAdvModal] = useState(null);
            const [advViewModal, setAdvViewModal] = useState(null);
            const [confirmDelete, setConfirmDelete] = useState(null);
            const [eventEditModal, setEventEditModal] = useState(null);
            const [confirmDeleteEvent, setConfirmDeleteEvent] = useState(null);
            const [selectedTags, setSelectedTags] = useState([]);
            const [showTagFilter, setShowTagFilter] = useState(false);

            useEffect(() => { if (!user) { navigate('/'); return; } loadData(); }, [user]);

            const loadData = async () => {
                try { const [advData, eventsData] = await Promise.all([api('/api/adventurers'), api('/api/profile/events')]); setAdventurers(advData); setEvents(eventsData); } 
                catch (err) { console.error(err); } 
                finally { setLoading(false); }
            };

            // Get all unique tags from all events
            const getAllTags = () => {
                const allTags = new Set();
                [...events.created, ...events.participated].forEach(ev => {
                    (ev.tags || []).forEach(tag => allTags.add(tag));
                });
                return [...allTags].sort();
            };

            // Toggle tag in filter
            const toggleTagFilter = (tag) => {
                setSelectedTags(prev => prev.includes(tag) ? prev.filter(t => t !== tag) : [...prev, tag]);
            };

            // Filter events by selected tags (show if ANY selected tag matches)
            const filterEventsByTag = (eventList) => {
                if (selectedTags.length === 0) return eventList;
                return eventList.filter(ev => (ev.tags || []).some(tag => selectedTags.includes(tag)));
            };

            const saveName = async () => {
                try { await api('/api/profile', { method: 'PUT', body: JSON.stringify({ displayName: tempName, profileImage: user.profileImage }) }); setUser({ ...user, displayName: tempName }); setEditingName(false); setMessage(t.profileUpdated); setTimeout(() => setMessage(''), 3000); } 
                catch (err) { setError(err.message); }
            };

            const saveImage = async () => {
                try { await api('/api/profile', { method: 'PUT', body: JSON.stringify({ displayName: user.displayName, profileImage: tempImage || null }) }); setUser({ ...user, profileImage: tempImage || null }); setEditingImage(false); setMessage(t.profileUpdated); setTimeout(() => setMessage(''), 3000); } 
                catch (err) { setError(err.message); }
            };

            const deleteImage = async () => {
                try { await api('/api/profile', { method: 'PUT', body: JSON.stringify({ displayName: user.displayName, profileImage: null }) }); setUser({ ...user, profileImage: null }); setTempImage(''); setEditingImage(false); setMessage(t.profileUpdated); setTimeout(() => setMessage(''), 3000); } 
                catch (err) { setError(err.message); }
            };

            const handleChangePassword = async (e) => {
                e.preventDefault(); setError(''); setMessage('');
                try { await api('/api/profile/password', { method: 'PUT', body: JSON.stringify({ currentPassword, newPassword }) }); setCurrentPassword(''); setNewPassword(''); setShowPasswordForm(false); setMessage(t.passwordChanged); setTimeout(() => setMessage(''), 3000); } 
                catch (err) { setError(err.message); }
            };

            const handleDeleteProfile = async () => {
                try {
                    await api('/api/profile', { method: 'DELETE' });
                    logout();
                } catch (err) { setError(err.message); }
            };

            const handleDeleteEvent = async (eventId) => {
                try {
                    await api(`/api/events/${eventId}`, { method: 'DELETE' });
                    setEvents({ ...events, created: events.created.filter(e => e.id !== eventId) });
                    setConfirmDeleteEvent(null);
                    setEventEditModal(null);
                } catch (err) { setError(err.message); }
            };

            const saveAdventurer = async (data) => {
                try {
                    if (advModal.mode === 'create') { 
                        const res = await api('/api/adventurers', { method: 'POST', body: JSON.stringify(data) }); 
                        setAdventurers([{ ...res, questBoardCount: 0, questBoards: [] }, ...adventurers]); 
                    } else { 
                        await api(`/api/adventurers/${advModal.id}`, { method: 'PUT', body: JSON.stringify(data) }); 
                        setAdventurers(adventurers.map(a => a.id === advModal.id ? { ...a, ...data } : a)); 
                    }
                    setAdvModal(null);
                } catch (err) { setError(err.message); }
            };

            const deleteAdventurer = async (id) => {
                try { await api(`/api/adventurers/${id}`, { method: 'DELETE' }); setAdventurers(adventurers.filter(a => a.id !== id)); setConfirmDelete(null); setAdvModal(null); } 
                catch (err) { setError(err.message); }
            };

            const getMyAdventurerForEvent = (eventId) => {
                const savedName = localStorage.getItem(`quest-board-user-${eventId}`);
                const savedImage = localStorage.getItem(`quest-board-user-image-${eventId}`);
                if (savedName) return { name: savedName, image: savedImage };
                return null;
            };

            const getMonthYearFromDates = (dates) => {
                if (!dates || dates.length === 0) return '';
                const monthYears = new Set();
                dates.forEach(d => {
                    const date = new Date(d + 'T12:00:00');
                    monthYears.add(`${t.months[date.getMonth()]} ${date.getFullYear()}`);
                });
                return [...monthYears].join(', ');
            };

            if (!user) return null;

            return (
                <div className="center-panel">
                    <div className="panel">
                        {error && <div className="error-message">{error}</div>}
                        {message && <div className="success-message">{message}</div>}

                        <div className="profile-header">
                            <div className="profile-image-container">
                                {editingImage ? (
                                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '0.5rem' }}>
                                        {tempImage ? <img src={tempImage} alt="" className="profile-image" onError={e => e.target.style.display = 'none'} /> : <div className="profile-image-placeholder">üë§</div>}
                                        <input type="url" value={tempImage} onChange={e => setTempImage(e.target.value)} placeholder="https://..." style={{ width: '150px', fontSize: '0.8rem', padding: '0.3rem' }} />
                                        <div className="edit-actions">
                                            <button className="edit-btn confirm" onClick={saveImage}>‚úì</button>
                                            <button className="edit-btn cancel" onClick={() => { setTempImage(user.profileImage || ''); setEditingImage(false); }}>‚úï</button>
                                            {user.profileImage && <button className="edit-btn delete" onClick={deleteImage}>üóë</button>}
                                        </div>
                                    </div>
                                ) : (
                                    <>
                                        {user.profileImage ? <img src={user.profileImage} alt="" className="profile-image" /> : <div className="profile-image-placeholder">üë§</div>}
                                        <div className="edit-icon" onClick={() => { setTempImage(user.profileImage || ''); setEditingImage(true); }}>‚úèÔ∏è</div>
                                    </>
                                )}
                            </div>
                            <div className="profile-info">
                                {editingName ? (
                                    <div className="inline-edit">
                                        <input type="text" value={tempName} onChange={e => setTempName(e.target.value)} className="inline-edit-input" autoFocus />
                                        <div className="edit-actions">
                                            <button className="edit-btn confirm" onClick={saveName}>‚úì</button>
                                            <button className="edit-btn cancel" onClick={() => { setTempName(user.displayName); setEditingName(false); }}>‚úï</button>
                                        </div>
                                    </div>
                                ) : (
                                    <h2>{user.displayName} <button className="name-edit-icon" onClick={() => { setTempName(user.displayName); setEditingName(true); }}>‚úèÔ∏è</button></h2>
                                )}
                                <p>@{user.username}</p>
                            </div>
                        </div>

                        <div className="password-section">
                            <div className="password-header" onClick={() => setShowPasswordForm(!showPasswordForm)}>
                                <h4>üîí {t.changePassword}</h4>
                                <span className={`toggle-arrow ${showPasswordForm ? 'open' : ''}`}>‚ñº</span>
                            </div>
                            {showPasswordForm && (
                                <form onSubmit={handleChangePassword} className="password-form">
                                    <div className="form-group"><label>{t.currentPassword}</label><input type="password" value={currentPassword} onChange={e => setCurrentPassword(e.target.value)} required /></div>
                                    <div className="form-group"><label>{t.newPassword}</label><input type="password" value={newPassword} onChange={e => setNewPassword(e.target.value)} required /></div>
                                    <div style={{ display: 'flex', gap: '0.5rem' }}>
                                        <button type="submit" className="btn btn-small btn-primary">{t.save}</button>
                                        <button type="button" className="btn btn-small btn-secondary" onClick={() => { setShowPasswordForm(false); setCurrentPassword(''); setNewPassword(''); }}>{t.cancel}</button>
                                    </div>
                                </form>
                            )}
                        </div>
                        <div className="password-section danger-section">
                            <div className="password-header" onClick={() => setShowDeleteProfile(!showDeleteProfile)}>
                                <h4>üóëÔ∏è {t.deleteProfile}</h4>
                                <span className={`toggle-arrow ${showDeleteProfile ? 'open' : ''}`}>‚ñº</span>
                            </div>
                            {showDeleteProfile && (
                                <div className="password-form">
                                    <p style={{ fontSize: '0.9rem', color: 'var(--unavailable)', marginBottom: '1rem' }}>{t.deleteProfileWarning}</p>
                                    <div style={{ display: 'flex', gap: '0.5rem' }}>
                                        <button type="button" className="btn btn-small btn-danger" onClick={handleDeleteProfile}>{t.yes}</button>
                                        <button type="button" className="btn btn-small btn-secondary" onClick={() => setShowDeleteProfile(false)}>{t.no}</button>
                                    </div>
                                </div>
                            )}
                        </div>

                        <hr className="divider" />

                        <div className="section-header">
                            <h3>‚öîÔ∏è {t.myAdventurers}</h3>
                            <button className="btn btn-small btn-primary" onClick={() => setAdvModal({ mode: 'create' })}>‚ûï</button>
                        </div>
                        {adventurers.length === 0 ? (
                            <p style={{ fontStyle: 'italic', color: 'var(--ink-light)', marginBottom: '1rem' }}>{t.noAdventurersSaved}</p>
                        ) : (
                            adventurers.map(adv => (
                                <div key={adv.id} className="adventurer-card" onClick={() => setAdvViewModal(adv)}>
                                    {adv.image ? <img src={adv.image} alt="" /> : <div className="no-image">‚öîÔ∏è</div>}
                                    <div className="info">
                                        <div className="name">{adv.name}</div>
                                        <div className="subtitle">
                                            {adv.level && `Lvl ${adv.level}`} {adv.race} {adv.class}
                                            {!adv.level && !adv.race && !adv.class && `üìÖ ${adv.questBoardCount || 0} ${t.questBoards}`}
                                        </div>
                                    </div>
                                    <div className="actions">
                                        <button className="btn btn-small btn-secondary" onClick={(e) => { e.stopPropagation(); setAdvModal({ mode: 'edit', ...adv }); }}>‚úèÔ∏è</button>
                                    </div>
                                </div>
                            ))
                        )}

                        <hr className="divider" />

                        <div className="section-header">
                            <h3>üìÖ {t.myQuestBoards}</h3>
                            <div className="section-actions">
                                <button className="btn btn-small btn-primary" onClick={() => navigate('/create')}>‚ûï</button>
                                <button className="btn btn-small btn-secondary" onClick={() => navigate('/join')}>üîó</button>
                            </div>
                        </div>

                        {/* Tag Filter Dropdown */}
                        {getAllTags().length > 0 && (
                            <div className="tag-filter">
                                <div className="tag-filter-dropdown">
                                    <button className="tag-filter-toggle" onClick={() => setShowTagFilter(!showTagFilter)}>
                                        üè∑Ô∏è {t.filterByTag} {selectedTags.length > 0 && `(${selectedTags.length})`} ‚ñº
                                    </button>
                                    {showTagFilter && (
                                        <div className="tag-filter-menu">
                                            <div className="tag-filter-item" onClick={() => setSelectedTags([])}>
                                                <input type="checkbox" checked={selectedTags.length === 0} readOnly />
                                                <span>{t.allTags}</span>
                                            </div>
                                            {getAllTags().map(tag => (
                                                <div key={tag} className="tag-filter-item" onClick={() => toggleTagFilter(tag)}>
                                                    <input type="checkbox" checked={selectedTags.includes(tag)} readOnly />
                                                    <span>{tag}</span>
                                                    <span className="tag-filter-count">
                                                        {[...events.created, ...events.participated].filter(ev => (ev.tags || []).includes(tag)).length}
                                                    </span>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                {selectedTags.length > 0 && (
                                    <div className="tags-display">
                                        {selectedTags.map(tag => <span key={tag} className="tag tag-removable" onClick={() => toggleTagFilter(tag)}>{tag}</span>)}
                                    </div>
                                )}
                            </div>
                        )}

                        {filterEventsByTag(events.created).length > 0 && (
                            <>
                                <p style={{ fontSize: '0.85rem', color: 'var(--ink-light)', marginBottom: '0.5rem' }}>üìú {t.createdByMe}</p>
                                {filterEventsByTag(events.created).map(ev => {
                                    const myAdv = getMyAdventurerForEvent(ev.id);
                                    const sortedParticipants = ev.participants ? [...ev.participants].sort((a, b) => {
                                        if (myAdv && a.name === myAdv.name) return -1;
                                        if (myAdv && b.name === myAdv.name) return 1;
                                        return 0;
                                    }) : [];
                                    return (
                                        <div key={ev.id} className={`event-list-item ${ev.image ? 'event-card-with-image' : ''}`} style={{ display: 'flex', alignItems: 'flex-start', gap: '1rem', cursor: 'pointer', position: 'relative', overflow: 'hidden' }} onClick={() => navigate(`/event/${ev.id}`)}>
                                            {ev.image && <div className="event-card-image" style={{ backgroundImage: `url(${ev.image})` }} />}
                                            <div style={{ flex: 1, position: 'relative', zIndex: 1 }}>
                                                {/* Tags at top */}
                                                {ev.tags && ev.tags.length > 0 && (
                                                    <div className="tag-row">
                                                        {ev.tags.map((tag, i) => <span key={i} className="tag">{tag}</span>)}
                                                    </div>
                                                )}
                                                <h4>{ev.name}</h4>
                                                <p>{ev.dates.length} dates ‚Ä¢ {getMonthYearFromDates(ev.dates)} {ev.description ? `‚Ä¢ ${ev.description}` : ''}</p>
                                                {/* Adventurers at bottom */}
                                                {sortedParticipants.length > 0 && (
                                                    <div className="participants-row">
                                                        {sortedParticipants.slice(0, 6).map((p, i) => (
                                                            <span key={i} className={`participant-tag ${myAdv && p.name === myAdv.name ? 'active' : ''}`} style={{ fontSize: '0.75rem', padding: '0.2rem 0.5rem' }}>
                                                                {p.image && p.image.length > 0 ? <img src={p.image} alt="" style={{ width: '16px', height: '16px' }} /> : null}
                                                                {p.name}
                                                            </span>
                                                        ))}
                                                        {sortedParticipants.length > 6 && <span style={{ fontSize: '0.75rem', color: 'var(--ink-light)' }}>+{sortedParticipants.length - 6}</span>}
                                                    </div>
                                                )}
                                            </div>
                                            <button className="btn btn-small btn-secondary" onClick={(e) => { e.stopPropagation(); setEventEditModal(ev); }} style={{ flexShrink: 0, position: 'relative', zIndex: 1 }}>‚úèÔ∏è</button>
                                        </div>
                                    );
                                })}
                            </>
                        )}

                        {filterEventsByTag(events.participated).length > 0 && (
                            <>
                                <p style={{ fontSize: '0.85rem', color: 'var(--ink-light)', marginTop: '1rem', marginBottom: '0.5rem' }}>üé≠ {t.participating}</p>
                                {filterEventsByTag(events.participated).map(ev => {
                                    const myAdv = getMyAdventurerForEvent(ev.id);
                                    const sortedParticipants = ev.participants ? [...ev.participants].sort((a, b) => {
                                        if (myAdv && a.name === myAdv.name) return -1;
                                        if (myAdv && b.name === myAdv.name) return 1;
                                        return 0;
                                    }) : [];
                                    return (
                                        <div key={ev.id} className={`event-list-item ${ev.image ? 'event-card-with-image' : ''}`} style={{ cursor: 'pointer', position: 'relative', overflow: 'hidden' }} onClick={() => navigate(`/event/${ev.id}`)}>
                                            {ev.image && <div className="event-card-image" style={{ backgroundImage: `url(${ev.image})` }} />}
                                            <div style={{ position: 'relative', zIndex: 1 }}>
                                                {/* Tags at top */}
                                                {ev.tags && ev.tags.length > 0 && (
                                                    <div className="tag-row">
                                                        {ev.tags.map((tag, i) => <span key={i} className="tag">{tag}</span>)}
                                                    </div>
                                                )}
                                                <h4>{ev.name}</h4>
                                                <p>{ev.dates.length} dates ‚Ä¢ {getMonthYearFromDates(ev.dates)} {ev.description ? `‚Ä¢ ${ev.description}` : ''}</p>
                                                {/* Adventurers at bottom */}
                                                {sortedParticipants.length > 0 && (
                                                    <div className="participants-row">
                                                        {sortedParticipants.slice(0, 6).map((p, i) => (
                                                            <span key={i} className={`participant-tag ${myAdv && p.name === myAdv.name ? 'active' : ''}`} style={{ fontSize: '0.75rem', padding: '0.2rem 0.5rem' }}>
                                                                {p.image && p.image.length > 0 ? <img src={p.image} alt="" style={{ width: '16px', height: '16px' }} /> : null}
                                                                {p.name}
                                                            </span>
                                                        ))}
                                                        {sortedParticipants.length > 6 && <span style={{ fontSize: '0.75rem', color: 'var(--ink-light)' }}>+{sortedParticipants.length - 6}</span>}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                            </>
                        )}

                        {filterEventsByTag(events.created).length === 0 && filterEventsByTag(events.participated).length === 0 && (
                            <p style={{ fontStyle: 'italic', color: 'var(--ink-light)' }}>{selectedTags.length > 0 ? `${t.noQuestBoards} (${selectedTags.join(', ')})` : t.noQuestBoards}</p>
                        )}
                    </div>

                    {/* View Adventurer Modal */}
                    {advViewModal && (
                        <div className="modal-overlay" onClick={() => setAdvViewModal(null)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1rem' }}>
                                    {advViewModal.image ? <img src={advViewModal.image} alt="" style={{ width: '80px', height: '80px', borderRadius: '50%', objectFit: 'cover', border: '3px solid var(--ink)' }} /> : <div style={{ width: '80px', height: '80px', borderRadius: '50%', background: 'var(--ink)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '2rem', color: 'var(--parchment)' }}>‚öîÔ∏è</div>}
                                    <div>
                                        <h3 style={{ margin: 0 }}>{advViewModal.name}</h3>
                                        {(advViewModal.level || advViewModal.race || advViewModal.class) && (
                                            <p style={{ color: 'var(--ink-light)', margin: '0.3rem 0 0 0' }}>
                                                {advViewModal.level && `Level ${advViewModal.level}`} {advViewModal.race} {advViewModal.class}
                                            </p>
                                        )}
                                    </div>
                                </div>
                                {advViewModal.bio && <p style={{ fontStyle: 'italic', marginBottom: '1rem', padding: '0.5rem', background: 'var(--parchment-light)', borderRadius: '3px' }}>{advViewModal.bio}</p>}
                                {advViewModal.notes && <p style={{ fontSize: '0.9rem', color: 'var(--ink-light)', marginBottom: '1rem' }}><strong>{t.notes}:</strong> {advViewModal.notes}</p>}
                                
                                {advViewModal.questBoards && advViewModal.questBoards.length > 0 && (
                                    <>
                                        <h4 style={{ fontFamily: 'Cinzel', fontSize: '0.9rem', marginBottom: '0.5rem' }}>üìÖ {t.myQuestBoards} ({advViewModal.questBoards.length})</h4>
                                        <div className="quest-board-list">
                                            {advViewModal.questBoards.map(qb => (
                                                <div key={qb.id} className="quest-board-list-item" onClick={() => { setAdvViewModal(null); navigate(`/event/${qb.id}`); }}>
                                                    <div style={{ flex: 1 }}>
                                                        {qb.tags && qb.tags.length > 0 && (
                                                            <div style={{ marginBottom: '0.3rem' }}>
                                                                {qb.tags.map((tag, i) => <span key={i} className="tag" style={{ fontSize: '0.6rem', padding: '0.1rem 0.3rem' }}>{tag}</span>)}
                                                            </div>
                                                        )}
                                                        <span className="name">{qb.name || qb.id}</span>
                                                    </div>
                                                    <span>‚Üí</span>
                                                </div>
                                            ))}
                                        </div>
                                    </>
                                )}
                                
                                <div className="modal-buttons">
                                    <button className="btn btn-secondary" onClick={() => setAdvViewModal(null)}>{t.cancel}</button>
                                    <button className="btn btn-primary" onClick={() => { setAdvModal({ mode: 'edit', ...advViewModal }); setAdvViewModal(null); }}>‚úèÔ∏è {t.edit}</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Edit Adventurer Modal */}
                    {advModal && <AdventurerEditModal t={t} modal={advModal} onClose={() => setAdvModal(null)} onSave={saveAdventurer} onDelete={(id) => setConfirmDelete(id)} />}

                    {/* Confirm Delete Modal */}
                    {confirmDelete && (
                        <div className="modal-overlay" onClick={() => setConfirmDelete(null)}>
                            <div className="modal confirm-dialog" onClick={e => e.stopPropagation()}>
                                <h3>‚ö†Ô∏è {t.deleteAdventurer}</h3>
                                <p>{t.confirmDelete}</p>
                                <div>
                                    <button className="btn btn-secondary" onClick={() => setConfirmDelete(null)}>{t.no}</button>
                                    <button className="btn btn-danger" onClick={() => deleteAdventurer(confirmDelete)}>{t.yes}</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Quest Board Edit Modal */}
                    {eventEditModal && (
                        <ProfileEventEditModal 
                            t={t} 
                            lang={lang}
                            event={eventEditModal} 
                            onClose={() => setEventEditModal(null)} 
                            onSave={async () => { await loadData(); setEventEditModal(null); }}
                            onDelete={() => setConfirmDeleteEvent(eventEditModal.id)}
                        />
                    )}

                    {/* Confirm Delete Event Modal */}
                    {confirmDeleteEvent && (
                        <div className="modal-overlay" onClick={() => setConfirmDeleteEvent(null)}>
                            <div className="modal confirm-dialog" onClick={e => e.stopPropagation()}>
                                <h3>‚ö†Ô∏è {t.deleteQuestBoard}</h3>
                                <p>{t.deleteQuestBoardWarning}</p>
                                <div>
                                    <button className="btn btn-secondary" onClick={() => setConfirmDeleteEvent(null)}>{t.no}</button>
                                    <button className="btn btn-danger" onClick={() => handleDeleteEvent(confirmDeleteEvent)}>{t.yes}</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function AdventurerEditModal({ t, modal, onClose, onSave, onDelete }) {
            const [name, setName] = useState(modal.name || '');
            const [image, setImage] = useState(modal.image || '');
            const [bio, setBio] = useState(modal.bio || '');
            const [level, setLevel] = useState(modal.level || '');
            const [race, setRace] = useState(modal.race || '');
            const [charClass, setCharClass] = useState(modal.class || '');
            const [notes, setNotes] = useState(modal.notes || '');

            const handleSave = () => {
                onSave({ name, image: image || null, bio: bio || null, level: level ? parseInt(level) : null, race: race || null, class: charClass || null, notes: notes || null });
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal modal-wide" onClick={e => e.stopPropagation()}>
                        <h3>‚öîÔ∏è {modal.mode === 'create' ? t.createAdventurer : t.editAdventurer}</h3>
                        <div className="form-group"><label>{t.adventurerName} *</label><input type="text" value={name} onChange={e => setName(e.target.value)} autoFocus /></div>
                        <div className="form-group">
                            <label>{t.adventurerImage}</label>
                            <input type="url" value={image} onChange={e => setImage(e.target.value)} placeholder="https://..." />
                            {image && <img src={image} alt="Preview" style={{ width: '60px', height: '60px', borderRadius: '50%', objectFit: 'cover', marginTop: '0.5rem' }} onError={e => e.target.style.display = 'none'} />}
                        </div>
                        <div className="form-row-3">
                            <div className="form-group"><label>{t.level}</label><input type="number" min="1" max="20" value={level} onChange={e => setLevel(e.target.value)} /></div>
                            <div className="form-group"><label>{t.race}</label><input type="text" value={race} onChange={e => setRace(e.target.value)} placeholder="Human, Elf..." /></div>
                            <div className="form-group"><label>{t.class}</label><input type="text" value={charClass} onChange={e => setCharClass(e.target.value)} placeholder="Fighter, Wizard..." /></div>
                        </div>
                        <div className="form-group"><label>{t.bio}</label><textarea rows={2} value={bio} onChange={e => setBio(e.target.value)} placeholder="A brief backstory..." /></div>
                        <div className="form-group"><label>{t.notes}</label><textarea rows={2} value={notes} onChange={e => setNotes(e.target.value)} placeholder="Player notes..." /></div>
                        <div className="modal-buttons-spread">
                            {modal.mode === 'edit' ? (
                                <button className="btn btn-danger btn-small" onClick={() => onDelete(modal.id)}>üóëÔ∏è {t.deleteAdventurer}</button>
                            ) : <div></div>}
                            <div style={{ display: 'flex', gap: '0.5rem' }}>
                                <button className="btn btn-secondary" onClick={onClose}>{t.cancel}</button>
                                <button className="btn btn-primary" onClick={handleSave} disabled={!name.trim()}>{t.save}</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function ProfileEventEditModal({ t, lang, event, onClose, onSave, onDelete }) {
            const [name, setName] = useState(event.name || '');
            const [description, setDescription] = useState(event.description || '');
            const [image, setImage] = useState(event.image || '');
            const [tags, setTags] = useState([...(event.tags || [])]);
            const [tagInput, setTagInput] = useState('');
            const [selectedDates, setSelectedDates] = useState([...(event.dates || [])]);
            const [startHour, setStartHour] = useState(event.startHour || 10);
            const [endHour, setEndHour] = useState(event.endHour || 22);
            const [currentMonth, setCurrentMonth] = useState(new Date());
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [warning, setWarning] = useState('');
            const timeFormat = localStorage.getItem('quest-board-time') || '12';

            const formatHourOption = (hour) => {
                if (timeFormat === '24') return `${hour.toString().padStart(2, '0')}:00`;
                if (hour === 0) return '12:00 AM';
                if (hour === 12) return '12:00 PM';
                if (hour < 12) return `${hour}:00 AM`;
                return `${hour - 12}:00 PM`;
            };

            const getDaysInMonth = (date) => {
                const year = date.getFullYear(), month = date.getMonth();
                const firstDay = new Date(year, month, 1), lastDay = new Date(year, month + 1, 0);
                const days = [];
                for (let i = 0; i < firstDay.getDay(); i++) days.push(null);
                for (let d = 1; d <= lastDay.getDate(); d++) days.push(new Date(year, month, d));
                return days;
            };

            const toggleDate = (date) => {
                const dateStr = date.toISOString().split('T')[0];
                setSelectedDates(prev => prev.includes(dateStr) ? prev.filter(d => d !== dateStr) : [...prev, dateStr].sort());
            };

            const addTag = () => {
                const tag = tagInput.trim();
                if (tag && tags.length < 3 && !tags.includes(tag)) {
                    setTags([...tags, tag]);
                    setTagInput('');
                }
            };

            const removeTag = (tagToRemove) => {
                setTags(tags.filter(t => t !== tagToRemove));
            };

            const handleSave = async () => {
                if (!name.trim() || selectedDates.length === 0) return;
                setLoading(true); setError('');
                try {
                    await api(`/api/events/${event.id}`, { 
                        method: 'PUT', 
                        body: JSON.stringify({ 
                            name: name.trim(), 
                            description: description.trim(),
                            dates: selectedDates,
                            startHour,
                            endHour,
                            image: image.trim() || null,
                            tags
                        }) 
                    });
                    onSave();
                } catch (err) { setError(err.message); } 
                finally { setLoading(false); }
            };

            const days = getDaysInMonth(currentMonth);
            const monthName = t.months[currentMonth.getMonth()] + ' ' + currentMonth.getFullYear();

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal modal-wide" onClick={e => e.stopPropagation()} style={{ maxHeight: '90vh', overflowY: 'auto' }}>
                        <h3>‚úèÔ∏è {t.editEvent}</h3>
                        {error && <div className="error-message">{error}</div>}
                        {warning && <div className="warning-message">{warning}</div>}
                        <div className="form-group">
                            <label>{t.eventName} *</label>
                            <input type="text" value={name} onChange={(e) => setName(e.target.value)} autoFocus />
                        </div>
                        <div className="form-group">
                            <label>{t.description}</label>
                            <textarea value={description} onChange={(e) => setDescription(e.target.value)} rows={2} />
                        </div>
                        <div className="form-group">
                            <label>{t.questBoardImage}</label>
                            <input type="url" value={image} onChange={(e) => setImage(e.target.value)} placeholder="https://..." />
                            {image && <div style={{ marginTop: '0.5rem', height: '60px', backgroundImage: `url(${image})`, backgroundSize: 'cover', backgroundPosition: 'center', borderRadius: '3px', opacity: 0.75 }} />}
                        </div>
                        <div className="form-group">
                            <label>{t.tags} ({tags.length}/3)</label>
                            <div className="tag-input-row">
                                <input type="text" value={tagInput} onChange={(e) => setTagInput(e.target.value)} placeholder={t.tagsPlaceholder} onKeyDown={(e) => { if (e.key === 'Enter') { e.preventDefault(); addTag(); } }} disabled={tags.length >= 3} />
                                <button type="button" className="btn btn-small btn-secondary" onClick={addTag} disabled={tags.length >= 3 || !tagInput.trim()}>{t.addTag}</button>
                            </div>
                            {tags.length > 0 && (
                                <div className="tags-display">
                                    {tags.map((tag, i) => <span key={i} className="tag tag-removable" onClick={() => removeTag(tag)}>{tag}</span>)}
                                </div>
                            )}
                        </div>
                        <div className="form-group">
                            <label>{t.selectDates} ({selectedDates.length} {t.selected})</label>
                            <div className="month-nav">
                                <button type="button" onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1))}>‚óÄ</button>
                                <span>{monthName}</span>
                                <button type="button" onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1))}>‚ñ∂</button>
                            </div>
                            <div className="date-picker-grid">
                                {t.daysShort.map((d, i) => <div key={i} className="date-picker-header">{d}</div>)}
                                {days.map((date, i) => {
                                    const dateStr = date ? date.toISOString().split('T')[0] : '';
                                    const isSelected = selectedDates.includes(dateStr);
                                    return <div key={i} className={`date-cell ${!date ? 'disabled' : ''} ${isSelected ? 'selected' : ''}`} onClick={() => date && toggleDate(date)}>{date ? date.getDate() : ''}</div>;
                                })}
                            </div>
                        </div>
                        <div className="form-row">
                            <div className="form-group">
                                <label>{t.startTime}</label>
                                <select value={startHour} onChange={(e) => setStartHour(Number(e.target.value))}>
                                    {Array.from({length: 24}, (_, i) => <option key={i} value={i}>{formatHourOption(i)}</option>)}
                                </select>
                            </div>
                            <div className="form-group">
                                <label>{t.endTime}</label>
                                <select value={endHour} onChange={(e) => setEndHour(Number(e.target.value))}>
                                    {Array.from({length: 24}, (_, i) => <option key={i} value={i}>{formatHourOption(i)}</option>)}
                                </select>
                            </div>
                        </div>
                        <div className="modal-buttons-spread">
                            <button className="btn btn-danger btn-small" onClick={onDelete}>üóëÔ∏è {t.deleteQuestBoard}</button>
                            <div style={{ display: 'flex', gap: '0.5rem' }}>
                                <button className="btn btn-secondary" onClick={onClose}>{t.cancel}</button>
                                <button className="btn btn-primary" onClick={handleSave} disabled={loading || !name.trim() || selectedDates.length === 0}>{loading ? '...' : t.update}</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function CreateEventPage({ t, lang, timeFormat }) {
            const { navigate } = useAuth();
            const [name, setName] = useState('');
            const [description, setDescription] = useState('');
            const [image, setImage] = useState('');
            const [tags, setTags] = useState([]);
            const [tagInput, setTagInput] = useState('');
            const [selectedDates, setSelectedDates] = useState([]);
            const [startHour, setStartHour] = useState(10);
            const [endHour, setEndHour] = useState(22);
            const [currentMonth, setCurrentMonth] = useState(new Date());
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const today = new Date(); today.setHours(0, 0, 0, 0);

            const formatHourOption = (hour) => {
                if (timeFormat === '24') return `${hour.toString().padStart(2, '0')}:00`;
                if (hour === 0) return '12:00 AM';
                if (hour === 12) return '12:00 PM';
                if (hour < 12) return `${hour}:00 AM`;
                return `${hour - 12}:00 PM`;
            };

            const getDaysInMonth = (date) => {
                const year = date.getFullYear(), month = date.getMonth();
                const firstDay = new Date(year, month, 1), lastDay = new Date(year, month + 1, 0);
                const days = [];
                for (let i = 0; i < firstDay.getDay(); i++) days.push(null);
                for (let d = 1; d <= lastDay.getDate(); d++) days.push(new Date(year, month, d));
                return days;
            };

            const toggleDate = (date) => {
                if (date < today) return;
                const dateStr = date.toISOString().split('T')[0];
                setSelectedDates(prev => prev.includes(dateStr) ? prev.filter(d => d !== dateStr) : [...prev, dateStr].sort());
            };

            const addTag = () => {
                const tag = tagInput.trim();
                if (tag && tags.length < 3 && !tags.includes(tag)) {
                    setTags([...tags, tag]);
                    setTagInput('');
                }
            };

            const removeTag = (tagToRemove) => {
                setTags(tags.filter(t => t !== tagToRemove));
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!name.trim() || selectedDates.length === 0) { setError(lang === 'sr' ? 'Molimo unesite naziv i izaberite bar jedan datum' : 'Please enter a name and select at least one date'); return; }
                setLoading(true); setError('');
                try { const res = await api('/api/events', { method: 'POST', body: JSON.stringify({ name: name.trim(), description: description.trim(), dates: selectedDates, startHour, endHour, image: image.trim() || null, tags }) }); navigate(res.url); } 
                catch (err) { setError(err.message || 'Network error'); } 
                finally { setLoading(false); }
            };

            const days = getDaysInMonth(currentMonth);
            const monthName = t.months[currentMonth.getMonth()] + ' ' + currentMonth.getFullYear();

            return (
                <div className="center-panel">
                    <div className="panel">
                        <h2>üìú {t.createNewQuest}</h2>
                        {error && <div className="error-message">{error}</div>}
                        <form onSubmit={handleSubmit}>
                            <div className="form-group"><label>{t.eventName} *</label><input type="text" value={name} onChange={(e) => setName(e.target.value)} placeholder={t.eventNamePlaceholder} required /></div>
                            <div className="form-group"><label>{t.description}</label><textarea value={description} onChange={(e) => setDescription(e.target.value)} placeholder={t.descriptionPlaceholder} rows={2} /></div>
                            <div className="form-group">
                                <label>{t.questBoardImage}</label>
                                <input type="url" value={image} onChange={(e) => setImage(e.target.value)} placeholder="https://..." />
                                {image && <div style={{ marginTop: '0.5rem', height: '60px', backgroundImage: `url(${image})`, backgroundSize: 'cover', backgroundPosition: 'center', borderRadius: '3px', opacity: 0.75 }} />}
                            </div>
                            <div className="form-group">
                                <label>{t.tags} ({tags.length}/3)</label>
                                <div className="tag-input-row">
                                    <input type="text" value={tagInput} onChange={(e) => setTagInput(e.target.value)} placeholder={t.tagsPlaceholder} onKeyDown={(e) => { if (e.key === 'Enter') { e.preventDefault(); addTag(); } }} disabled={tags.length >= 3} />
                                    <button type="button" className="btn btn-small btn-secondary" onClick={addTag} disabled={tags.length >= 3 || !tagInput.trim()}>{t.addTag}</button>
                                </div>
                                {tags.length > 0 && (
                                    <div className="tags-display">
                                        {tags.map((tag, i) => <span key={i} className="tag tag-removable" onClick={() => removeTag(tag)}>{tag}</span>)}
                                    </div>
                                )}
                            </div>
                            <div className="form-group">
                                <label>{t.selectDates} * ({selectedDates.length} {t.selected})</label>
                                <div className="month-nav">
                                    <button type="button" onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1))}>‚óÄ</button>
                                    <span>{monthName}</span>
                                    <button type="button" onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1))}>‚ñ∂</button>
                                </div>
                                <div className="date-picker-grid">
                                    {t.daysShort.map((d, i) => <div key={i} className="date-picker-header">{d}</div>)}
                                    {days.map((date, i) => <div key={i} className={`date-cell ${!date ? 'disabled' : ''} ${date && date < today ? 'disabled' : ''} ${date && selectedDates.includes(date.toISOString().split('T')[0]) ? 'selected' : ''}`} onClick={() => date && toggleDate(date)}>{date ? date.getDate() : ''}</div>)}
                                </div>
                            </div>
                            <div className="form-row">
                                <div className="form-group"><label>{t.startTime}</label><select value={startHour} onChange={(e) => setStartHour(Number(e.target.value))}>{Array.from({length: 24}, (_, i) => <option key={i} value={i}>{formatHourOption(i)}</option>)}</select></div>
                                <div className="form-group"><label>{t.endTime}</label><select value={endHour} onChange={(e) => setEndHour(Number(e.target.value))}>{Array.from({length: 24}, (_, i) => <option key={i} value={i}>{formatHourOption(i)}</option>)}</select></div>
                            </div>
                            <button type="submit" className="btn btn-primary btn-block" disabled={loading}>{loading ? t.creating : `‚öîÔ∏è ${t.createQuestBoard}`}</button>
                        </form>
                    </div>
                </div>
            );
        }

        function EventPage({ eventId, t, lang, timeFormat }) {
            const { user, navigate } = useAuth();
            const [event, setEvent] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');
            const [currentUser, setCurrentUser] = useState('');
            const [currentUserImage, setCurrentUserImage] = useState('');
            const [userSlots, setUserSlots] = useState({});
            const [viewMode, setViewMode] = useState('group');
            const [tooltip, setTooltip] = useState(null);
            const [noteModal, setNoteModal] = useState(null);
            const [tempNote, setTempNote] = useState('');
            const [nameModal, setNameModal] = useState(false);
            const [switchModal, setSwitchModal] = useState(false);
            const [editEventModal, setEditEventModal] = useState(false);
            const [viewAdventurerModal, setViewAdventurerModal] = useState(null);
            const [tempName, setTempName] = useState('');
            const [showSaved, setShowSaved] = useState(false);
            const [copied, setCopied] = useState(false);
            const [adventurers, setAdventurers] = useState([]);
            const [selectedAdventurer, setSelectedAdventurer] = useState(null);
            const [isDragging, setIsDragging] = useState(false);
            const [dragMode, setDragMode] = useState(null);
            const [draggedSlots, setDraggedSlots] = useState(new Set());

            useEffect(() => { fetchEvent(); if (user) fetchAdventurers(); }, [eventId, user]);

            const fetchEvent = async () => {
                try {
                    const data = await api(`/api/events/${eventId}`);
                    setEvent(data);
                    const savedUser = localStorage.getItem(`quest-board-user-${eventId}`);
                    const savedImage = localStorage.getItem(`quest-board-user-image-${eventId}`);
                    if (savedUser && data.participants.includes(savedUser)) { setCurrentUser(savedUser); setCurrentUserImage(savedImage || ''); setUserSlots(data.availability[savedUser] || {}); }
                } catch (err) { setError(t.eventNotFound); } finally { setLoading(false); }
            };

            const fetchAdventurers = async () => { try { const data = await api('/api/adventurers'); setAdventurers(data); } catch {} };

            const saveAvailability = async (slots, name = currentUser, image = currentUserImage) => {
                if (!name) return;
                try { await api(`/api/events/${eventId}/availability`, { method: 'POST', body: JSON.stringify({ participantName: name, participantImage: image || null, slots }) }); await fetchEvent(); setShowSaved(true); setTimeout(() => setShowSaved(false), 2000); } 
                catch (err) { console.error('Failed to save:', err); }
            };

            const handleJoin = () => {
                let name, image;
                if (selectedAdventurer) { name = selectedAdventurer.name; image = selectedAdventurer.image || ''; } 
                else { name = tempName.trim(); image = ''; }
                if (!name) return;
                setCurrentUser(name); setCurrentUserImage(image);
                localStorage.setItem(`quest-board-user-${eventId}`, name);
                localStorage.setItem(`quest-board-user-image-${eventId}`, image);
                if (event.availability[name]) setUserSlots(event.availability[name]); else setUserSlots({});
                setNameModal(false); setTempName(''); setSelectedAdventurer(null); setViewMode('edit');
            };

            const handleSwitchAdventurer = async () => {
                let name, image;
                if (selectedAdventurer) { name = selectedAdventurer.name; image = selectedAdventurer.image || ''; } 
                else { name = tempName.trim(); image = ''; }
                if (!name) return;
                
                const currentSlots = { ...userSlots };
                const oldUser = currentUser;
                
                if (oldUser && oldUser !== name) {
                    try { await api(`/api/events/${eventId}/availability/${encodeURIComponent(oldUser)}`, { method: 'DELETE' }); } 
                    catch (err) { console.error('Failed to remove old availability:', err); }
                }
                
                setCurrentUser(name); setCurrentUserImage(image);
                localStorage.setItem(`quest-board-user-${eventId}`, name);
                localStorage.setItem(`quest-board-user-image-${eventId}`, image);
                
                if (event.availability[name]) { setUserSlots(event.availability[name]); } 
                else { setUserSlots(currentSlots); await saveAvailability(currentSlots, name, image); }
                
                await fetchEvent();
                setSwitchModal(false); setTempName(''); setSelectedAdventurer(null);
            };

            const handleMouseDown = (date, hour, e) => {
                if (viewMode !== 'edit' || !currentUser || e.button !== 0) return;
                e.preventDefault();
                const key = getSlotKey(date, hour);
                setIsDragging(true); setDragMode(userSlots[key]?.available ? 'remove' : 'add'); setDraggedSlots(new Set([key]));
            };

            const handleMouseEnter = (date, hour) => { if (!isDragging || viewMode !== 'edit') return; setDraggedSlots(prev => new Set([...prev, getSlotKey(date, hour)])); };

            const handleMouseUp = () => {
                if (!isDragging) return;
                const newSlots = { ...userSlots };
                draggedSlots.forEach(key => { if (dragMode === 'add') newSlots[key] = { available: true, note: newSlots[key]?.note || '' }; else { if (newSlots[key]) newSlots[key] = { ...newSlots[key], available: false }; } });
                setUserSlots(newSlots); saveAvailability(newSlots);
                setIsDragging(false); setDragMode(null); setDraggedSlots(new Set());
            };

            useEffect(() => { const handler = () => { if (isDragging) handleMouseUp(); }; window.addEventListener('mouseup', handler); return () => window.removeEventListener('mouseup', handler); }, [isDragging, dragMode, draggedSlots, userSlots]);

            // Allow notes on any slot (available or not)
            const openNoteModal = (date, hour, e) => { 
                e.preventDefault(); e.stopPropagation(); 
                if (viewMode !== 'edit' || !currentUser) return; 
                const key = getSlotKey(date, hour); 
                setTempNote(userSlots[key]?.note || ''); 
                setNoteModal({ date, hour }); 
            };

            const saveNote = () => { 
                if (!noteModal) return; 
                const key = getSlotKey(noteModal.date, noteModal.hour); 
                const newSlots = { ...userSlots }; 
                if (!newSlots[key]) newSlots[key] = { available: false, note: '' };
                newSlots[key] = { ...newSlots[key], note: tempNote }; 
                setUserSlots(newSlots); 
                saveAvailability(newSlots); 
                setNoteModal(null); 
                setTempNote(''); 
            };

            const getSlotAvailability = (date, hour) => { if (!event) return []; const key = getSlotKey(date, hour); return event.participants.filter(name => event.availability[name]?.[key]?.available).map(name => ({ name, note: event.availability[name][key].note || '', image: event.participantImages?.[name] || '' })); };
            const getSlotNotes = (date, hour) => { if (!event) return []; const key = getSlotKey(date, hour); return event.participants.filter(name => event.availability[name]?.[key]?.note && !event.availability[name]?.[key]?.available).map(name => ({ name, note: event.availability[name][key].note, image: event.participantImages?.[name] || '' })); };

            const getSlotClass = (date, hour) => {
                const key = getSlotKey(date, hour);
                if (isDragging && draggedSlots.has(key)) return dragMode === 'add' ? 'dragging' : 'empty';
                if (viewMode === 'edit') return userSlots[key]?.available ? 'available' : 'empty';
                const available = getSlotAvailability(date, hour);
                const ratio = available.length / (event.participants.length || 1);
                if (ratio === 0) return 'empty'; if (ratio < 0.2) return 'level-1'; if (ratio < 0.4) return 'level-2'; if (ratio < 0.6) return 'level-3'; if (ratio < 0.8) return 'level-4'; return 'level-5';
            };

            const hasNote = (date, hour) => { 
                const key = getSlotKey(date, hour); 
                if (viewMode === 'edit') return (userSlots[key]?.note || '').length > 0; 
                const availableNotes = getSlotAvailability(date, hour).some(a => a.note.length > 0);
                const otherNotes = getSlotNotes(date, hour).length > 0;
                return availableNotes || otherNotes;
            };

            const handleSlotHover = (e, date, hour) => { const rect = e.target.getBoundingClientRect(); setTooltip({ x: Math.min(rect.right + 10, window.innerWidth - 300), y: Math.min(rect.top, window.innerHeight - 200), date, hour, available: getSlotAvailability(date, hour), notes: getSlotNotes(date, hour) }); };
            const copyLink = () => { navigator.clipboard.writeText(window.location.href); setCopied(true); setTimeout(() => setCopied(false), 2000); };

            const formatHour = (hour) => { if (timeFormat === '24') return { hour: hour.toString().padStart(2, '0'), ampm: '' }; if (hour === 0) return { hour: '12', ampm: 'AM' }; if (hour === 12) return { hour: '12', ampm: 'PM' }; if (hour < 12) return { hour: hour.toString(), ampm: 'AM' }; return { hour: (hour - 12).toString(), ampm: 'PM' }; };
            const formatDateForDisplay = (dateStr) => { const date = new Date(dateStr + 'T12:00:00'); return { dayName: t.days[date.getDay()], dayNum: t.ordinal(date.getDate()) }; };
            const formatTooltipDate = (dateStr, hour) => { const date = new Date(dateStr + 'T12:00:00'); const h = formatHour(hour); const timeStr = timeFormat === '24' ? `${h.hour}:00` : `${h.hour} ${h.ampm}`; return `${t.days[date.getDay()]}, ${t.months[date.getMonth()]} ${t.ordinal(date.getDate())} ${t.atTime} ${timeStr}`; };
            const groupDatesByMonth = (dates) => { const groups = []; let cur = null; dates.forEach((ds, i) => { const d = new Date(ds + 'T12:00:00'); const k = `${d.getFullYear()}-${d.getMonth()}`; if (!cur || cur.key !== k) { cur = { key: k, name: t.months[d.getMonth()], count: 1 }; groups.push(cur); } else cur.count++; }); return groups; };

            const viewPublicAdventurer = async (name) => {
                try {
                    const data = await api(`/api/adventurers/public/${encodeURIComponent(name)}`);
                    setViewAdventurerModal(data);
                } catch {
                    setViewAdventurerModal({ name, image: event.participantImages?.[name] });
                }
            };

            const isOwner = user && event && event.creatorId === user.id;

            if (loading) return <div className="panel loading">üé≤ {t.loadingDice}</div>;
            if (error) return <div className="panel"><div className="error-message">{error}</div></div>;

            const hours = []; for (let h = event.startHour; h < event.endHour; h++) hours.push(h);
            const monthGroups = groupDatesByMonth(event.dates);

            return (
                <>
                    <div className="main-content">
                        <aside className="panel">
                            <h2>‚öîÔ∏è {t.adventurer}</h2>
                            {!currentUser ? (
                                <><p style={{marginBottom: '1rem', fontStyle: 'italic'}}>{t.joinPrompt}</p><button className="btn btn-primary btn-block" onClick={() => setNameModal(true)}>üé≠ {t.joinQuest}</button></>
                            ) : (
                                <>
                                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '1rem' }}>
                                        <span className="participant-tag active">
                                            {currentUserImage && currentUserImage.length > 0 ? <img src={currentUserImage} alt="" /> : null}
                                            {currentUser}
                                        </span>
                                        <button className="switch-adventurer-btn" onClick={() => setSwitchModal(true)} title={t.switchAdventurer}>üîÑ</button>
                                    </div>
                                    <div className="view-toggle">
                                        <button className={`btn ${viewMode === 'group' ? 'active' : 'btn-secondary'}`} onClick={() => setViewMode('group')}>üë• {t.group}</button>
                                        <button className={`btn ${viewMode === 'edit' ? 'active' : 'btn-secondary'}`} onClick={() => setViewMode('edit')}>‚úèÔ∏è {t.edit}</button>
                                    </div>
                                    {viewMode === 'edit' && <div className="instructions"><strong>{t.instructionsTitle}</strong><ul><li>{t.instruction1}</li><li>{t.instruction2}</li><li>{t.instruction3}</li></ul></div>}
                                </>
                            )}
                            <h2 style={{marginTop: '1.5rem'}}>üé≠ {t.party} ({event.participants.length})</h2>
                            <div>{event.participants.length === 0 ? <p style={{fontStyle: 'italic', fontSize: '0.9rem'}}>{t.noAdventurers}</p> : event.participants.map(name => <span key={name} className={`participant-tag ${name === currentUser ? 'active' : ''}`} onClick={() => name !== currentUser && viewPublicAdventurer(name)}>{event.participantImages?.[name] && event.participantImages[name].length > 0 ? <img src={event.participantImages[name]} alt="" /> : null}{name}</span>)}</div>
                            <div className="share-box"><strong>üì® {t.inviteParty}</strong><span className="share-url">{window.location.href}</span><button className="btn btn-secondary" onClick={copyLink}>{copied ? `‚úì ${t.copied}` : `üìã ${t.copyLink}`}</button></div>
                            <div className="legend">{viewMode === 'group' ? <><div className="legend-item"><div className="legend-color" style={{background: 'var(--available)'}}></div><span>{t.all}</span></div><div className="legend-item"><div className="legend-color" style={{background: '#7bc47a'}}></div><span>{t.most}</span></div><div className="legend-item"><div className="legend-color" style={{background: '#a8d5a2'}}></div><span>{t.some}</span></div></> : <div className="legend-item"><div className="legend-color" style={{background: 'var(--available)'}}></div><span>{t.available}</span></div>}<div className="legend-item"><span>üìú</span><span>{t.hasNote}</span></div></div>
                        </aside>
                        <main className="panel" style={{ position: 'relative', overflow: 'hidden' }}>
                            {event.image && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '100px', backgroundImage: `url(${event.image})`, backgroundSize: 'cover', backgroundPosition: 'center', opacity: 0.6, maskImage: 'linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,0.5) 50%, rgba(0,0,0,0) 100%)', WebkitMaskImage: 'linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,0.5) 50%, rgba(0,0,0,0) 100%)', pointerEvents: 'none' }} />}
                            <div style={{ position: 'relative', zIndex: 1 }}>
                                {event.tags && event.tags.length > 0 && (
                                    <div style={{ marginBottom: '0.5rem' }}>
                                        {event.tags.map((tag, i) => <span key={i} className="tag">{tag}</span>)}
                                    </div>
                                )}
                                <h2>
                                    <span>üìÖ {event.name}</span>
                                    {isOwner && <button className="edit-event-btn" onClick={() => setEditEventModal(true)} title={t.editEvent}>‚úèÔ∏è</button>}
                                </h2>
                                {event.description && <p style={{marginBottom: '1rem', fontStyle: 'italic'}}>{event.description}</p>}
                                <div className="schedule-grid">
                                    <div className="grid-container" style={{ gridTemplateColumns: `60px repeat(${event.dates.length}, 1fr)`, marginBottom: '2px' }}>
                                        <div style={{background: 'transparent'}}></div>
                                        {monthGroups.map(g => <div key={g.key} className="month-header" style={{ gridColumn: `span ${g.count}` }}>{g.name}</div>)}
                                    </div>
                                    <div className="grid-container" style={{ gridTemplateColumns: `60px repeat(${event.dates.length}, 1fr)`, gridTemplateRows: `auto repeat(${hours.length}, 1fr)` }}>
                                        <div style={{background: 'transparent'}}></div>
                                        {event.dates.map(date => { const { dayName, dayNum } = formatDateForDisplay(date); return <div key={date} className="grid-header"><span className="day-name">{dayName}</span><span className="day-number">{dayNum}</span></div>; })}
                                        {hours.map(hour => { const { hour: hourStr, ampm } = formatHour(hour); return (
                                            <React.Fragment key={hour}>
                                                <div className="time-label"><span className="hour">{hourStr}</span>{ampm && <span className="ampm">{ampm}</span>}</div>
                                                {event.dates.map(date => <div key={`${date}-${hour}`} className={`time-slot ${getSlotClass(date, hour)} ${hasNote(date, hour) ? 'has-note' : ''}`} onMouseDown={(e) => handleMouseDown(date, hour, e)} onMouseEnter={() => handleMouseEnter(date, hour)} onContextMenu={(e) => openNoteModal(date, hour, e)} onMouseOver={(e) => !isDragging && handleSlotHover(e, date, hour)} onMouseLeave={() => !isDragging && setTooltip(null)}>{viewMode === 'group' && getSlotAvailability(date, hour).length > 0 && <span className="availability-count">{getSlotAvailability(date, hour).length}</span>}</div>)}
                                            </React.Fragment>
                                        ); })}
                                    </div>
                                </div>
                            </div>
                        </main>
                    </div>

                    {tooltip && !isDragging && (
                        <div className="tooltip" style={{ left: tooltip.x, top: tooltip.y }}>
                            <h4>{formatTooltipDate(tooltip.date, tooltip.hour)}</h4>
                            {tooltip.available.length === 0 && tooltip.notes.length === 0 ? (
                                <p style={{fontStyle: 'italic'}}>{t.noOneAvailable}</p>
                            ) : (
                                <>
                                    {tooltip.available.map((a, i) => (
                                        <div key={i} className="tooltip-entry">
                                            {a.image && a.image.length > 0 ? <img src={a.image} alt="" /> : null}
                                            <div>
                                                <div className="tooltip-name">{a.name}</div>
                                                {a.note && <div className="tooltip-note">"{a.note}"</div>}
                                            </div>
                                        </div>
                                    ))}
                                    {tooltip.notes.map((a, i) => (
                                        <div key={`note-${i}`} className="tooltip-entry" style={{ borderLeftColor: 'var(--partial)' }}>
                                            {a.image && a.image.length > 0 ? <img src={a.image} alt="" /> : null}
                                            <div>
                                                <div className="tooltip-name" style={{ opacity: 0.7 }}>‚è≥ {a.name}</div>
                                                <div className="tooltip-note">"{a.note}"</div>
                                            </div>
                                        </div>
                                    ))}
                                </>
                            )}
                        </div>
                    )}

                    {/* Join Modal */}
                    {nameModal && (
                        <div className="modal-overlay" onClick={() => setNameModal(false)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <h3>üé≠ {t.enterName}</h3>
                                {user && adventurers.length > 0 && (
                                    <>
                                        <p style={{marginBottom: '0.5rem', fontWeight: '600'}}>{t.selectAdventurer}</p>
                                        {adventurers.map(adv => <div key={adv.id} className="adventurer-card" style={{ cursor: 'pointer', border: selectedAdventurer?.id === adv.id ? '2px solid var(--gold)' : undefined }} onClick={() => { setSelectedAdventurer(adv); setTempName(''); }}>{adv.image ? <img src={adv.image} alt="" /> : <div className="no-image">‚öîÔ∏è</div>}<div className="info"><div className="name">{adv.name}</div></div></div>)}
                                        <p style={{marginTop: '1rem', marginBottom: '0.5rem', color: 'var(--ink-light)', textAlign: 'center'}}>‚Äî {t.orEnterName} ‚Äî</p>
                                    </>
                                )}
                                <p style={{marginBottom: '0.5rem', color: 'var(--ink-light)'}}>{t.howShouldPartyKnow}</p>
                                <div className="form-group"><input type="text" value={tempName} onChange={(e) => { setTempName(e.target.value); setSelectedAdventurer(null); }} placeholder={t.yourName} onKeyDown={(e) => e.key === 'Enter' && handleJoin()} /></div>
                                <div className="modal-buttons">
                                    <button className="btn btn-secondary" onClick={() => setNameModal(false)}>{t.cancel}</button>
                                    <button className="btn btn-primary" onClick={handleJoin} disabled={!tempName.trim() && !selectedAdventurer}>{selectedAdventurer ? t.useAdventurer : t.joinQuest}</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Switch Modal */}
                    {switchModal && (
                        <div className="modal-overlay" onClick={() => setSwitchModal(false)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <h3>üîÑ {t.switchAdventurer}</h3>
                                {user && adventurers.length > 0 && (
                                    <>
                                        <p style={{marginBottom: '0.5rem', fontWeight: '600'}}>{t.selectAdventurer}</p>
                                        {adventurers.map(adv => <div key={adv.id} className="adventurer-card" style={{ cursor: 'pointer', border: selectedAdventurer?.id === adv.id ? '2px solid var(--gold)' : undefined }} onClick={() => { setSelectedAdventurer(adv); setTempName(''); }}>{adv.image ? <img src={adv.image} alt="" /> : <div className="no-image">‚öîÔ∏è</div>}<div className="info"><div className="name">{adv.name}</div></div></div>)}
                                        <p style={{marginTop: '1rem', marginBottom: '0.5rem', color: 'var(--ink-light)', textAlign: 'center'}}>‚Äî {t.orEnterName} ‚Äî</p>
                                    </>
                                )}
                                <div className="form-group"><input type="text" value={tempName} onChange={(e) => { setTempName(e.target.value); setSelectedAdventurer(null); }} placeholder={t.yourName} onKeyDown={(e) => e.key === 'Enter' && handleSwitchAdventurer()} /></div>
                                <div className="modal-buttons">
                                    <button className="btn btn-secondary" onClick={() => setSwitchModal(false)}>{t.cancel}</button>
                                    <button className="btn btn-primary" onClick={handleSwitchAdventurer} disabled={!tempName.trim() && !selectedAdventurer}>{t.switchAdventurer}</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Note Modal */}
                    {noteModal && (
                        <div className="modal-overlay" onClick={() => setNoteModal(null)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <h3>üìú {t.addNote}</h3>
                                <p style={{marginBottom: '1rem', color: 'var(--ink-light)'}}>{formatTooltipDate(noteModal.date, noteModal.hour)}</p>
                                <div className="form-group"><label>{t.yourNote}</label><textarea value={tempNote} onChange={(e) => setTempNote(e.target.value)} rows={3} placeholder={t.notePlaceholder} autoFocus /></div>
                                <div className="modal-buttons">
                                    <button className="btn btn-secondary" onClick={() => setNoteModal(null)}>{t.cancel}</button>
                                    <button className="btn btn-primary" onClick={saveNote}>{t.saveNote}</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Edit Event Modal */}
                    {editEventModal && <EditEventModal t={t} lang={lang} timeFormat={timeFormat} event={event} onClose={() => setEditEventModal(false)} onSave={async () => { await fetchEvent(); setEditEventModal(false); }} />}

                    {/* View Adventurer Modal */}
                    {viewAdventurerModal && (
                        <div className="modal-overlay" onClick={() => setViewAdventurerModal(null)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1rem' }}>
                                    {viewAdventurerModal.image ? <img src={viewAdventurerModal.image} alt="" style={{ width: '80px', height: '80px', borderRadius: '50%', objectFit: 'cover', border: '3px solid var(--ink)' }} /> : <div style={{ width: '80px', height: '80px', borderRadius: '50%', background: 'var(--ink)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '2rem', color: 'var(--parchment)' }}>‚öîÔ∏è</div>}
                                    <div>
                                        <h3 style={{ margin: 0 }}>{viewAdventurerModal.name}</h3>
                                        {(viewAdventurerModal.level || viewAdventurerModal.race || viewAdventurerModal.class) && (
                                            <p style={{ color: 'var(--ink-light)', margin: '0.3rem 0 0 0' }}>
                                                {viewAdventurerModal.level && `Level ${viewAdventurerModal.level}`} {viewAdventurerModal.race} {viewAdventurerModal.class}
                                            </p>
                                        )}
                                    </div>
                                </div>
                                {viewAdventurerModal.bio && <p style={{ fontStyle: 'italic', marginBottom: '1rem', padding: '0.5rem', background: 'var(--parchment-light)', borderRadius: '3px' }}>{viewAdventurerModal.bio}</p>}
                                <div className="modal-buttons">
                                    <button className="btn btn-secondary" onClick={() => setViewAdventurerModal(null)}>{t.cancel}</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showSaved && <div className="saved-indicator">‚úì {t.saved}</div>}
                </>
            );
        }

        function EditEventModal({ t, lang, timeFormat, event, onClose, onSave }) {
            const [name, setName] = useState(event.name);
            const [description, setDescription] = useState(event.description || '');
            const [image, setImage] = useState(event.image || '');
            const [tags, setTags] = useState([...(event.tags || [])]);
            const [tagInput, setTagInput] = useState('');
            const [selectedDates, setSelectedDates] = useState([...event.dates]);
            const [startHour, setStartHour] = useState(event.startHour);
            const [endHour, setEndHour] = useState(event.endHour);
            const [currentMonth, setCurrentMonth] = useState(new Date());
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [warning, setWarning] = useState('');

            const today = new Date(); today.setHours(0, 0, 0, 0);

            const datesWithAvailability = new Set();
            Object.values(event.availability).forEach(slots => {
                Object.keys(slots).forEach(key => {
                    if (slots[key]?.available) {
                        const date = key.split('-').slice(0, 3).join('-');
                        datesWithAvailability.add(date);
                    }
                });
            });

            const formatHourOption = (hour) => {
                if (timeFormat === '24') return `${hour.toString().padStart(2, '0')}:00`;
                if (hour === 0) return '12:00 AM';
                if (hour === 12) return '12:00 PM';
                if (hour < 12) return `${hour}:00 AM`;
                return `${hour - 12}:00 PM`;
            };

            const getDaysInMonth = (date) => {
                const year = date.getFullYear(), month = date.getMonth();
                const firstDay = new Date(year, month, 1), lastDay = new Date(year, month + 1, 0);
                const days = [];
                for (let i = 0; i < firstDay.getDay(); i++) days.push(null);
                for (let d = 1; d <= lastDay.getDate(); d++) days.push(new Date(year, month, d));
                return days;
            };

            const toggleDate = (date) => {
                const dateStr = date.toISOString().split('T')[0];
                const isRemoving = selectedDates.includes(dateStr);
                
                if (isRemoving && datesWithAvailability.has(dateStr)) {
                    setWarning(t.warningRemoveDates);
                }
                
                setSelectedDates(prev => prev.includes(dateStr) ? prev.filter(d => d !== dateStr) : [...prev, dateStr].sort());
            };

            const addTag = () => {
                const tag = tagInput.trim();
                if (tag && tags.length < 3 && !tags.includes(tag)) {
                    setTags([...tags, tag]);
                    setTagInput('');
                }
            };

            const removeTag = (tagToRemove) => {
                setTags(tags.filter(t => t !== tagToRemove));
            };

            const handleSave = async () => {
                if (!name.trim() || selectedDates.length === 0) return;
                setLoading(true); setError('');
                try {
                    await api(`/api/events/${event.id}`, { method: 'PUT', body: JSON.stringify({ name: name.trim(), description: description.trim(), dates: selectedDates, startHour, endHour, image: image.trim() || null, tags }) });
                    onSave();
                } catch (err) { setError(err.message); } 
                finally { setLoading(false); }
            };

            const days = getDaysInMonth(currentMonth);
            const monthName = t.months[currentMonth.getMonth()] + ' ' + currentMonth.getFullYear();

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal modal-wide" onClick={e => e.stopPropagation()} style={{ maxHeight: '90vh', overflowY: 'auto' }}>
                        <h3>‚úèÔ∏è {t.editEvent}</h3>
                        {error && <div className="error-message">{error}</div>}
                        {warning && <div className="warning-message">{warning}</div>}
                        <div className="form-group"><label>{t.eventName} *</label><input type="text" value={name} onChange={(e) => setName(e.target.value)} /></div>
                        <div className="form-group"><label>{t.description}</label><textarea value={description} onChange={(e) => setDescription(e.target.value)} rows={2} /></div>
                        <div className="form-group">
                            <label>{t.questBoardImage}</label>
                            <input type="url" value={image} onChange={(e) => setImage(e.target.value)} placeholder="https://..." />
                            {image && <div style={{ marginTop: '0.5rem', height: '60px', backgroundImage: `url(${image})`, backgroundSize: 'cover', backgroundPosition: 'center', borderRadius: '3px', opacity: 0.75 }} />}
                        </div>
                        <div className="form-group">
                            <label>{t.tags} ({tags.length}/3)</label>
                            <div className="tag-input-row">
                                <input type="text" value={tagInput} onChange={(e) => setTagInput(e.target.value)} placeholder={t.tagsPlaceholder} onKeyDown={(e) => { if (e.key === 'Enter') { e.preventDefault(); addTag(); } }} disabled={tags.length >= 3} />
                                <button type="button" className="btn btn-small btn-secondary" onClick={addTag} disabled={tags.length >= 3 || !tagInput.trim()}>{t.addTag}</button>
                            </div>
                            {tags.length > 0 && (
                                <div className="tags-display">
                                    {tags.map((tag, i) => <span key={i} className="tag tag-removable" onClick={() => removeTag(tag)}>{tag}</span>)}
                                </div>
                            )}
                        </div>
                        <div className="form-group">
                            <label>{t.selectDates} ({selectedDates.length} {t.selected})</label>
                            <div className="month-nav">
                                <button type="button" onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1))}>‚óÄ</button>
                                <span>{monthName}</span>
                                <button type="button" onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1))}>‚ñ∂</button>
                            </div>
                            <div className="date-picker-grid">
                                {t.daysShort.map((d, i) => <div key={i} className="date-picker-header">{d}</div>)}
                                {days.map((date, i) => {
                                    const dateStr = date ? date.toISOString().split('T')[0] : '';
                                    const isSelected = selectedDates.includes(dateStr);
                                    const hasAvail = datesWithAvailability.has(dateStr);
                                    return <div key={i} className={`date-cell ${!date ? 'disabled' : ''} ${isSelected ? 'selected' : ''} ${hasAvail && !isSelected ? 'has-availability' : ''}`} onClick={() => date && toggleDate(date)}>{date ? date.getDate() : ''}</div>;
                                })}
                            </div>
                            <p style={{ fontSize: '0.75rem', color: 'var(--ink-light)', marginTop: '0.5rem' }}>üü° = has existing availability</p>
                        </div>
                        <div className="form-row">
                            <div className="form-group"><label>{t.startTime}</label><select value={startHour} onChange={(e) => setStartHour(Number(e.target.value))}>{Array.from({length: 24}, (_, i) => <option key={i} value={i}>{formatHourOption(i)}</option>)}</select></div>
                            <div className="form-group"><label>{t.endTime}</label><select value={endHour} onChange={(e) => setEndHour(Number(e.target.value))}>{Array.from({length: 24}, (_, i) => <option key={i} value={i}>{formatHourOption(i)}</option>)}</select></div>
                        </div>
                        <div className="modal-buttons">
                            <button className="btn btn-secondary" onClick={onClose}>{t.cancel}</button>
                            <button className="btn btn-primary" onClick={handleSave} disabled={loading || !name.trim() || selectedDates.length === 0}>{loading ? '...' : t.update}</button>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
